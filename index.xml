<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Yong’s 网络日志</title>
    <link>https://blog.yongs.ml/</link>
    <description>Recent content on Yong’s 网络日志</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh&#34; target=&#34;_blank&#34;&gt;CC BY-NC-SA 4.0&lt;/a&gt;</copyright>
    <lastBuildDate>Sun, 06 Feb 2022 17:05:32 +0800</lastBuildDate><atom:link href="https://blog.yongs.ml/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>比价助手机器人docker快速部署</title>
      <link>https://blog.yongs.ml/posts/comparison-robot-building-for-docker/</link>
      <pubDate>Sun, 06 Feb 2022 17:05:32 +0800</pubDate>
      
      <guid>https://blog.yongs.ml/posts/comparison-robot-building-for-docker/</guid>
      <description>对于商品比价是个不错的购买商品的方法，可以给我们是否值得入手这件商品提供决策。各大商</description>
      <content:encoded><![CDATA[<blockquote>
<p>对于商品比价是个不错的购买商品的方法，可以给我们是否值得入手这件商品提供决策。各大商城有这方面数据但不会免费给分享出来，第三方网站有相关服务，但体验不好，相关api也太贵，这次找到了大佬免费提供的对话bot的比价助手——傻妞助手，应该是内置比价api吧！目前来说数据还可以值得参考的，用了docker部署，很快搞定！</p>
</blockquote>
<h1 id="一部署傻妞助手bot">一、部署傻妞助手bot</h1>
<p>项目地址：<a href="https://github.com/cdle/sillyGirl">GitHub - cdle/sillyGirl: 傻妞机器人</a></p>
<h3 id="一键安装支持linux-arm64和amd64位">一键安装：支持linux arm64和amd64位</h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#fff;font-weight:bold">cd</span> /opt
s=sillyGirl;a=arm64;<span style="color:#fff;font-weight:bold">if</span> [[ <span style="color:#fff;font-weight:bold">$(</span>uname -a | grep <span style="color:#0ff;font-weight:bold">&#34;x86_64&#34;</span><span style="color:#fff;font-weight:bold">)</span> != <span style="color:#0ff;font-weight:bold">&#34;&#34;</span> ]];<span style="color:#fff;font-weight:bold">then</span> a=amd64;<span style="color:#fff;font-weight:bold">fi</span> ;<span style="color:#fff;font-weight:bold">if</span> [ ! -d $s ];<span style="color:#fff;font-weight:bold">then</span> mkdir $s;<span style="color:#fff;font-weight:bold">fi</span> ;<span style="color:#fff;font-weight:bold">cd</span> $s;wget https://github.com/cdle/<span style="color:#0ff;font-weight:bold">${</span>s<span style="color:#0ff;font-weight:bold">}</span>/releases/download/main/<span style="color:#0ff;font-weight:bold">${</span>s<span style="color:#0ff;font-weight:bold">}</span>_linux_$a -O $s &amp;&amp; chmod <span style="color:#ff0;font-weight:bold">777</span> $s;pkill -9 $s;<span style="color:#fff;font-weight:bold">$(</span><span style="color:#fff;font-weight:bold">pwd</span><span style="color:#fff;font-weight:bold">)</span>/$s

</code></pre></div><p>在目录/etc/sillyGirl下新建sets.conf可以进行初始化配置</p>
<p>主要是配置管理员账号等，也可以通过对话配置</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">### 一些基础设置 ###
# 傻妞机器人名
set sillyGirl name 傻妞
# 傻妞http服务端口
set sillyGirl port 800


# 傻妞消息撤回等待时间，单位秒
set sillyGirl duration 5
# 傻妞自动升级是否通知
set sillyGirl update_notify true
# 是否开启傻妞自动更新
set sillyGirl auto_update false
# 傻妞内置赞赏码
set sillyGirl appreciate https://gitee.com/aiancandle/sillyGirl/raw/main/appreciate.jpg
#是否启动http服务
set sillyGirl enable_http_server true
# 关闭守护模式，守护模式会导致没法自动升级
#systemctl disable sillyGirl

### 对接青龙的设置 ###
# 设置青龙openapi的client_id参数
#set qinglong client_id ?
# 设置青龙openapi的client_secret参数
#set qinglong client_secret ?
# 青龙是否开启自动隐藏重复任务功能
#set qinglong autoCronHideDuplicate true
# 设置青龙面板地址
#set qinglong host http://127.0.0.1:5700

### 对接QQ的设置 ###
# 设置qq登录账号
#set qq uin ?
# 设置qq登录密码
#set qq password ?
# 设置qq临时消息默认群号
#set qq tempMessageGroupCode ?
# 指定要监听的qq群
#set qq onGroups g1&amp;g2&amp;g3...
# 设置是否自动同意好友请求
#set qq auto_friend false
# 设置是否对监听自身消息
#set qq onself true
# 设置qq管理员
#set qq masters q1&amp;q2&amp;q3...
# 设置接受通知的qq账号
#set qq notifier q1&amp;q2&amp;q3...
# 设置qq设备信息(自动生成)
#set qq device.json ?
# 设置qq登录令牌(自动生成)
#set qq session.token ?
# 注销qqbot命令，重新运行扫码即可
#delete qq session.token
# 指定系统通知发送对象命令，如不设置默认发送给所有管理员。
#set [im type] notifiers [accounts join by &#39;&amp;&#39;] 

### 对接telegram的设置 ###
# 设置telegram机器人token
#set tg token ?
# 设置telegram机器人代理
#set tg http_proxy ?
# 设置telegram机器人管理员
#set tg masters t1&amp;t2&amp;t3...
# 设置接受通知的telegram账号
#set tg notifier t1&amp;t2&amp;t3...

### 对接微信公众号的设置 ###
# 设置微信公众平台app_id
#set wxmp app_id ?
# 设置微信公众平台app_secret
#set wxmp app_secret ?
# 设置微信公众平台token
#set wxmp token ?
# 设置微信公众平台encoding_aes_key
#set wxmp encoding_aes_key ?
# 设置微信公众平台管理员
#set wxmp masters w1&amp;w2&amp;w3...
# 设置公众号关注事件回复
#set wxmp subscribe_reply 感谢关注！
# 设置公众号默认回复
#set wxmp default_reply 无法回复该消息

### 对接微信号的设置 ###
# 傻妞内置微信插件，依赖于可爱猫和http-sdk
# 傻妞远程处理接口 /wx/receive
# 设置插件调用地址，确保傻妞可以访问可爱猫端口
#set wx api_url ?
# 设置图片转发模式，否则可能会出现此图片来自xx未经允许不得使用的提示
set wx relay_mode true
# 设置指定转发地址，格式为 https://域名/relay?url=%s，不知道不用填
#set wx relaier ?
# 设置# 傻妞是否动态网络地址，适用于# 傻妞家庭宽带而可爱猫在云服务器的情况下
#set wx sillyGirl_dynamic_ip true
# 设置可爱猫是否动态网络地址，适用于可爱猫家庭宽带而# 傻妞在云服务器的情况下
#set wx keaimao_dynamic_ip true
# 设置可爱猫端口
#set wx keaimao_port ?
# 设置微信管理员
#set wx masters ?
# vlw的API调用地址
#set wx vlw_addr http://ip:port
# vlw的token
#set wx vlw_token ?

### 对接pushplus的设置 ###
# 管理员推送绑定pushplus指令
#set sillyGirl pushplus [token]

# 关键词撤回功能，关键词支持正则表达式。
#set sillyGirl recall 关键词1&amp;关键词2...
# 关键词回复功能，第一个问号是支持正则的关键词，第二个问号是回复的内容。
#set reply ? ?

### 对接芝士的设置 ###
# 资产推送定时，以九点为例，包括失效提醒。
set jd_cookie asset_push 0 9 * * *

# 设置阿东登录地址，例：set jd_cookie adong_addr 192.168.1.1:5702
#set jd_cookie adong_addr 阿东ip:端口
# 设置阿东qq机器人账号，这里的机器人qq账号，请务必和阿东go-cqhttp配置中config.yml里qq一样。
#set jd_cookie selfQid 机器人qq账号
# 设置登录坑位
#set jd_cookie login_num ?

#设置诺兰登陆地址
#set jd_cookie nolan_addr http://诺兰ip:端口

# 对接xdd，额外设置参数
#set jd_cookie xdd_token ?

### 对接小爱同学的设置 ###
# 小爱同学，可以指定API，对小爱说对话模式即可开启连续对话模式，闭嘴可关闭。
#set sillyGirl 小爱同学 http://81.70.100.130/api/xiaoai.php?msg=%s&amp;n=text #挂了就自己换
#set sillyGirl 小爱同学 http://jiuli.xiaoapi.cn/i/xiaoai_tts.php?msg=%s #挂了就自己换
# 处理json格式数据的小爱api，不填获取整个文本
#set sillyGirl 小爱同学gjson text
# 删除处理json格式数据的小爱api
#silly delete 小爱同学gjson
# 使用方法：
#1、唤起小爱：发送“小爱+想说的话”，例如：小爱今天天气。
#2、对话模式：发送“小爱对话模式”开启，发送“闭嘴”结束。
#3、成语接龙：发送“成语接龙”开始。这个可应该不是小爱同学的功能，但我懒得单独写它了。

### 对接短网址的设置 ###
# 设置短网址服务地址，填傻妞对外的可以访问的地址。
#set dwz address ?
# 设置短网址服务前缀
#set dwz prefix d
# 使用方法
#发送“短网址+你想要转换的网址“ #例：短网址 http://kejiwanjia.com/
</code></pre></div><h3 id="启动命令">启动命令</h3>
<p>配置完成后，在/opt/sillyGirl下执行 ./sillyGirl -t 查看是否运行成功</p>
<p>输入  time</p>
<p>成功后 执行 ./sillyGirl -d 后台运行</p>
<h3 id="其他常用命令">其他常用命令</h3>
<p>杀掉进程</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -A|grep sillyGirl
<span style="color:#fff;font-weight:bold">kill</span> pid 
</code></pre></div><p>查看端口是否开启</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">netstat -tlan
</code></pre></div><h1 id="二部署node-onebot">二、部署node-onebot</h1>
<blockquote>
<p>傻妞开发者把内置qq登录给去掉了，需要自己对接qqbot</p>
<p>官方给的是node安装的，需要安装node环境，太麻烦，改为用docker安装</p>
</blockquote>
<h3 id="1拉取代码">1、拉取代码</h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">//国外机
git clone https://github.com/takayama-lily/node-onebot

//国内机

git clone https://ghproxy.861443216.workers.dev/https://github.com/takayama-lily/node-onebot
机
</code></pre></div><h3 id="2修改dockerfile文件">2、修改Dockerfile文件</h3>
<p>修改默认Dockerfile里面最后一行的QQ号成自己的bot账号</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">FROM node:14-alpine
WORKDIR /app
COPY . .
CMD [&#34;node&#34;, &#34;main&#34;,&#34;这里改为自己的bot账号&#34;]
</code></pre></div><h3 id="3创建configjs文件">3、创建config.js文件</h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp config.sample.js config.js
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#0ff;font-weight:bold">&#34;use strict&#34;</span>;
<span style="color:#007f7f">// 将此文件更名为config.js才能生效哦
</span><span style="color:#007f7f"></span>
module.exports = {

    <span style="color:#007f7f">//通用配置
</span><span style="color:#007f7f"></span>    general: {
        platform:           <span style="color:#ff0;font-weight:bold">5</span>,      <span style="color:#007f7f">//1:安卓手机 2:aPad 3:安卓手表 4:MacOS 5:iPad
</span><span style="color:#007f7f"></span>        debug:              <span style="color:#fff;font-weight:bold">false</span>,  <span style="color:#007f7f">//开启debug
</span><span style="color:#007f7f"></span>        use_cqhttp_notice:  <span style="color:#fff;font-weight:bold">true</span>,   <span style="color:#007f7f">//是否使用cqhttp标准的notice事件格式
</span><span style="color:#007f7f"></span>
        host:               <span style="color:#0ff;font-weight:bold">&#34;localhost&#34;</span>,  <span style="color:#007f7f">//监听主机名
</span><span style="color:#007f7f"></span>        port:               <span style="color:#ff0;font-weight:bold">5700</span>,       <span style="color:#007f7f">//端口
</span><span style="color:#007f7f"></span>        use_http:           <span style="color:#fff;font-weight:bold">false</span>,      <span style="color:#007f7f">//启用http
</span><span style="color:#007f7f"></span>        use_ws:             <span style="color:#fff;font-weight:bold">false</span>,      <span style="color:#007f7f">//启用正向ws，和http使用相同地址和端口
</span><span style="color:#007f7f"></span>        access_token:       <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>,         <span style="color:#007f7f">//访问api的token
</span><span style="color:#007f7f"></span>        secret:             <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>,         <span style="color:#007f7f">//上报数据的sha1签名密钥
</span><span style="color:#007f7f"></span>        post_timeout:       <span style="color:#ff0;font-weight:bold">30</span>,         <span style="color:#007f7f">//post超时时间(秒)
</span><span style="color:#007f7f"></span>        post_message_format:<span style="color:#0ff;font-weight:bold">&#34;array&#34;</span>,    <span style="color:#007f7f">//&#34;string&#34;或&#34;array&#34;
</span><span style="color:#007f7f"></span>        enable_cors:        <span style="color:#fff;font-weight:bold">false</span>,      <span style="color:#007f7f">//是否允许跨域请求
</span><span style="color:#007f7f"></span>        enable_heartbeat:   <span style="color:#fff;font-weight:bold">false</span>,      <span style="color:#007f7f">//是否启用ws心跳
</span><span style="color:#007f7f"></span>        heartbeat_interval: <span style="color:#ff0;font-weight:bold">15000</span>,      <span style="color:#007f7f">//ws心跳间隔(毫秒)
</span><span style="color:#007f7f"></span>        rate_limit_interval:<span style="color:#ff0;font-weight:bold">500</span>,        <span style="color:#007f7f">//使用_rate_limited后缀限速调用api的排队间隔时间(毫秒)
</span><span style="color:#007f7f"></span>        event_filter:       <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>,         <span style="color:#007f7f">//json格式的事件过滤器文件路径
</span><span style="color:#007f7f"></span>        post_url: [ <span style="color:#007f7f">//上报地址，可以添加多个url
</span><span style="color:#007f7f"></span>            <span style="color:#007f7f">// &#34;http://your.address.com:80&#34;,
</span><span style="color:#007f7f"></span>        ],
        ws_reverse_url: [ <span style="color:#007f7f">//反向ws地址，可以添加多个url
</span><span style="color:#007f7f"></span>            <span style="color:#0ff;font-weight:bold">&#34;ws://127.0.0.1:8080/qq/receive&#34;</span>,
            <span style="color:#007f7f">//这是傻妞的反向链接地址，其中的8080端口记得改成你傻妞的端口，同时开启傻妞的傻妞的http server，即set sillyGirl enable_http_server true
</span><span style="color:#007f7f"></span>        ],
        ws_reverse_reconnect_interval: <span style="color:#ff0;font-weight:bold">3000</span>, <span style="color:#007f7f">//反向ws断线重连间隔(毫秒)，设为负数直接不重连
</span><span style="color:#007f7f"></span>        ws_reverse_reconnect_on_code_1000: <span style="color:#fff;font-weight:bold">true</span>, <span style="color:#007f7f">//反向ws是否在关闭状态码为1000的时候重连
</span><span style="color:#007f7f"></span>    },

    <span style="color:#007f7f">//每个账号的单独配置(用于覆盖通用配置)
</span><span style="color:#007f7f"></span>    <span style="color:#ff0;font-weight:bold">147258369</span>: {

    },
};

<span style="color:#007f7f">// 安全注意：
</span><span style="color:#007f7f">// 监听0.0.0.0表示监听网卡上的所有地址。如果你的机器可以通过公网ip直接访问，同时你也没有设定access_token，则被认为是极不安全的。
</span><span style="color:#007f7f">// 你应该知道这样做会导致以下后果：任何人都可以无限制地访问你的Bot的所有API接口。
</span><span style="color:#007f7f">// 如果只需要在本地访问，建议将监听地址改为localhost。需要通过公网访问，你最好设定access_token。
</span></code></pre></div><h3 id="4编译docker-image">4、编译docker image</h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build -t yongs/node-onebot:latest .
</code></pre></div><p>yongs自定义的，随便起，一定不要忘了 最后又个<u> . </u>表示在当前目录文件编译</p>
<h3 id="5启动image">5、启动image</h3>
<p>用的是docker-compose启动的，刚才拉的代码已经有yaml文件了，</p>
<p>需要注意 image名字是刚才编译的名字，不知道可以用</p>
<p>docker images 查看，修改image名字即可</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="font-weight:bold">version</span>: <span style="color:#0ff;font-weight:bold">&#34;3&#34;</span>
<span style="font-weight:bold">services</span>:
  <span style="font-weight:bold">miraiok</span>:
    <span style="font-weight:bold">image</span>: yongs/node-onebot
    <span style="font-weight:bold">restart</span>: always
    <span style="font-weight:bold">network_mode</span>: <span style="color:#0ff;font-weight:bold">&#34;host&#34;</span>
    <span style="font-weight:bold">volumes</span>:
      - ./config.js:/root/config.js
      - ./data:/root/data
    <span style="font-weight:bold">stdin_open</span>: <span style="color:#fff;font-weight:bold">true</span>
    <span style="font-weight:bold">tty</span>: <span style="color:#fff;font-weight:bold">true</span>
    <span style="font-weight:bold">container_name</span>: docker-onebot
</code></pre></div><h3 id="6查看日志扫码登录不能登录进入容器内扫码">6、查看日志，扫码登录，不能登录进入容器内扫码</h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#007f7f">#查看日志</span>
docker logs -f docker-onebot
<span style="color:#007f7f">#进入容器</span>
docker <span style="color:#fff;font-weight:bold">exec</span> -it docker-onebot /bin/sh
<span style="color:#007f7f">#执行登录</span>
node main <span style="color:#0ff;font-weight:bold">&#34;botqq号&#34;</span>
</code></pre></div><p>给小助手发送命令看是否成功，比如 发送 name</p>
<p>发送 淘宝京豆拼多多链接看是否回复，回复即部署成功。</p>
<p>登录成功后，重启docker即可</p>
<p>这里的坑就是傻妞启动失败，导致onebot连接不上傻妞。</p>
<blockquote>
<p>参考链接：</p>
<p>1、<a href="https://www.kejiwanjia.com/jiaocheng/zheteng/19778.html#node-onebotqqbot">群晖傻妞SillyGirl完整部署教程 12.13更新node-onebot - 科技玩家</a></p>
<p>2、<a href="https://www.kejiwanjia.com/jiaocheng/51905.html">Docker编译node-onebot，傻妞又活了 - 科技玩家</a></p>
<p>3、<a href="https://github.com/AboutCXJ/SillyGirlDockerDeploy">GitHub - AboutCXJ/SillyGirlDockerDeploy</a></p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>Hugo 自动更新文章修改时间</title>
      <link>https://blog.yongs.ml/posts/hugo-auto-update-lastmod/</link>
      <pubDate>Sat, 22 Jan 2022 21:34:31 +0800</pubDate>
      
      <guid>https://blog.yongs.ml/posts/hugo-auto-update-lastmod/</guid>
      <description>config配置文件里加上如下参数： frontmatter: lastmod: - lastmod - :git - :fileModTime - :default 依次取的顺序为： lastmod :最后提交</description>
      <content:encoded><![CDATA[<p>config配置文件里加上如下参数：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="font-weight:bold">frontmatter</span>:
    <span style="font-weight:bold">lastmod</span>:
        - lastmod
        - :git
        - :fileModTime
        - :default
</code></pre></div><p>依次取的顺序为：</p>
<blockquote>
<p>lastmod :最后提交时间</p>
<p>:git: 根据git提交版本时间</p>
<p>:fileModTime：文件修改时间</p>
</blockquote>
<p><a href="https://gohugo.io/getting-started/configuration/#configure-front-matter">Configure Hugo | Hugo</a> 写的都有,but是英文的🙃</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Docker Compose部署filebrowser</title>
      <link>https://blog.yongs.ml/posts/docker-deploy-filebrowser/</link>
      <pubDate>Fri, 21 Jan 2022 11:24:05 +0800</pubDate>
      
      <guid>https://blog.yongs.ml/posts/docker-deploy-filebrowser/</guid>
      <description>docker快速搭建个人网盘</description>
      <content:encoded><![CDATA[<p>在linuxserver服务器上安装</p>
<p>环境：docker、docker- compose</p>
<p>需要了解docker基本知识，不懂可以翻翻以前的博客或者搜下教程学习</p>
<p><a href="https://filebrowser.org/installation">filebrowser</a>官网上给的是docker命令执行的，但用compose习惯了，所以转换了一下格式，但是这里有个坑，官网也提示了</p>
<blockquote>
<p>By default, we already have a <a href="https://github.com/filebrowser/filebrowser/blob/master/docker/root/defaults/settings.json">configuration file with some defaults</a> so you can just mount the root and the database. Although you can overwrite by mounting a directory with a new config file. If you don&rsquo;t already have a database file, make sure to create a new empty file under the path you specified. Otherwise, Docker will create an empty folder instead of an empty file, resulting in an error when mounting the database into the container.</p>
</blockquote>
<p>翻译过来就是需要提前创建所需的文件和文件夹，否则，Docker会创建一个空的文件夹而不是空的文件，导致在将数据库挂载到容器中时出现错误！这点一定要注意啊！！！</p>
<h1 id="1创建docker-compose文件">1、创建docker-compose文件</h1>
<p>内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="font-weight:bold">version</span>: <span style="color:#0ff;font-weight:bold">&#39;3.3&#39;</span> 
<span style="font-weight:bold">services</span>:     
    <span style="font-weight:bold">filebrowser</span>:  
        <span style="font-weight:bold">image</span>: filebrowser/filebrowser:s6
        <span style="font-weight:bold">container_name</span>: filebrowser
        <span style="font-weight:bold">volumes</span>:  
            - ./root:/srv           
            - ./database/filebrowser.db:/database/filebrowser.db 
            - ./settings.json:/config/settings.json
        <span style="font-weight:bold">environment</span>:
            - PUID=0
            - PGID=0
        <span style="font-weight:bold">ports</span>: 
            - <span style="color:#0ff;font-weight:bold">&#39;8080:80&#39;</span>         
        <span style="font-weight:bold">restart</span>: always
</code></pre></div><h1 id="2创建默认文件和文件夹">2、创建默认文件和文件夹</h1>
<p>对照上述docker-compose的路径，需要在当前目录创建 settings.json 文件，内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="font-weight:bold">&#34;port&#34;</span>: <span style="color:#ff0;font-weight:bold">80</span>,
  <span style="font-weight:bold">&#34;baseURL&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>,
  <span style="font-weight:bold">&#34;address&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;0.0.0.0&#34;</span>,
  <span style="font-weight:bold">&#34;log&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;stdout&#34;</span>,
  <span style="font-weight:bold">&#34;database&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;/database/filebrowser.db&#34;</span>,
  <span style="font-weight:bold">&#34;root&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;/srv&#34;</span>
}
</code></pre></div><p>在当前目录创建 database/filebrowser.db 文件夹和文件</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir database
<span style="color:#fff;font-weight:bold">cd</span> database
touch filebrowser.db
</code></pre></div><h1 id="3运行测试是否成功">3、运行测试是否成功</h1>
<p>执行 docker- compose logs -f 看下日志是否报错</p>
<p>需要其他机器访问记得防火墙 把端口打开，本例用的8080端口</p>
<p>浏览器访问 服务器ip:8080 成功打开即可，Enjoy it！🎉🎉🎉</p>
<blockquote>
<p>参考：</p>
<p>1、<a href="https://filebrowser.org">filebrowser官网</a></p>
<p>2、<a href="https://www.liuhaolin.com/zhuanzai/906.html">filebrowser 一个跨平台的文件管理器的使用方法-森林的个人博客</a></p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>About</title>
      <link>https://blog.yongs.ml/about/</link>
      <pubDate>Thu, 13 Jan 2022 20:56:38 +0800</pubDate>
      
      <guid>https://blog.yongs.ml/about/</guid>
      <description>欢迎来到我的小站呀，很高兴遇见你！🤝 🏠 关于本站 这里主要记录一些平常遇到的一些技术坑，</description>
      <content:encoded><![CDATA[<blockquote>
<p>欢迎来到我的小站呀，很高兴遇见你！🤝</p>
</blockquote>
<h2 id="-关于本站">🏠 关于本站</h2>
<p>这里主要记录一些平常遇到的一些技术坑，方便以后可以查阅😄</p>
<p>本站最开始是2019年就搭建了，当时用的hexo构建，部署在github，用netlify缓存服务，无奈当时穷，用的还是Windows本，用命令太不爽了，导致写文章没什么激情，基本断更🤣</p>
<p>来到2021年，经常在网上看大佬们的blog，时间有点空，就想把blog给拾起来，接触的技术也多了，也想记录下一些笔记，方便后面随时翻阅，正好在推上看到大佬们推荐<a href="https://github.com/getgridea/gridea">gridea: ✍️ A static blog writing client (一个静态博客写作客户端)</a></p>
<p>傻瓜式操作，根据界面提示设置就行了，专注于写作，当时就下下来用了一段时间，也有比较鸡肋的地方，比如主题太少，自定义空间太小，还有就是windows7上不太稳定，有时会卡，可能我电脑垃圾吧，主题太少，有的主题不支持侧边目录栏，当时搜了好多文章，才改了一下主题，具体看<a href="../posts/girde-simple-support-for-sidebar-directory/">这篇</a>，还有就是，作者好久不更新了，专注于搞web端了，所以就在换了Mac后就换了到hugo上</p>
<p><a href="https://gohugo.io/">hugo</a>用go开发的，据说生成文章非常快，相比hexo来说，hugo在Mac上用命令也很舒服，主题也很多，所以就果断换了上来，专注写作，主题用的<a href="https://git.io/hugopapermod">papermod</a>，这是国外开发者开发的，中文资料太少，不过，搜了好多大佬的文章，基本上调试ok；还是用github做仓库来提供服务，用markdown来写文章，vs code来配置文件，在<a href="https://www.freenom.com/">freenom</a>上白嫖的一年域名，用脚本自动监控，到期提示；用cf来做域名解析和缓存服务。</p>
<h2 id="-博主是谁">👨‍💻 博主是谁</h2>
<p>匆匆的蚂蚁</p>
<p>克莱登大学毕业</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>docker 生成自己的镜像</title>
      <link>https://blog.yongs.ml/posts/docker-generate-image/</link>
      <pubDate>Mon, 21 Jun 2021 23:26:34 +0000</pubDate>
      
      <guid>https://blog.yongs.ml/posts/docker-generate-image/</guid>
      <description>看过前面的文章知道，大佬的库仓库也锁了，不能pull，只能换取仓库地址才行，为了一劳</description>
      <content:encoded><![CDATA[<p>看过前面的文章知道，大佬的库仓库也锁了，不能pull，只能换取仓库地址才行，为了一劳永逸，索性换了自己的库，只谈技术，不谈其他&hellip;</p>
<!-- more -->
<h3 id="1创建dockerfile文件">1、创建Dockerfile文件</h3>
<p>比较懒，直接把大佬的Dockerfile拉来换了仓库地址，rsa记着也要换</p>
<p>换完在当前目录 <code>docker build -t jd_scripts .</code></p>
<p>直接生成自己的image</p>
<p><code>docker images</code> 查看镜像</p>
<h3 id="2修改docker-compose文件">2、修改docker-compose文件</h3>
<p>修改docker-compose里面的仓库地址为自己的地址，其他参数不用变</p>
<p><code>docker-compose up -d</code> 启动镜像</p>
<p>完美运行！</p>
<p>继续躺平。</p>
<p>建议学学docker，真的好强大！</p>
<p>附上一个不错的docker教程</p>
<p><a href="https://yeasy.gitbook.io/docker_practice/"><img loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAABk0lEQVRYR&#43;2W3UvCUByGX7fchQpZuvmRq1WEUElWEEPMDMz&#43;mf7Bym4qJCjJCCsUJeii8hOhAt3AWGBkkc6dpF2c3e685zzn&#43;f3O2Syd4l4HJn4sFJCwOtQgoUBQg9QgqQHSPO1BapDUAGm&#43;bw9mr3K4zN70rMEwDFyTToRCQUwH/LAwDClD37wuQK&#43;Xh91u&#43;5hIaSt4LlfRarUhij7EohvgOG5kkLoAt&#43;MypBnxE0JVFZxfXOMuX8TCvISIvAaGZUcCaQhQI9EgU0dpVGt17O7EwPMucwFqNIVCCafpDFbDiwivLJkPsFKpYf/wGIEpH&#43;JbsnkBJ5zjSCY2kbvN/zj1g6hnJbHv5gz3oLZw12AX8OX1DY1GcxBTz3uHwwZBcP&#43;a&#43;RNA05bY1IdEu7APUieoN5pIJqLwePihSqt3sKESa3DpswxK9w/muKi/f&#43;oen8pQVBVzkoiIvA4rZ9UrZOhxugx&#43;nZUdYyG4XQgtB&#43;H3Cf/7szD0dkcQoL/8pFKpQWqQ1ABpnvYgNUhqgDRPe5DU4DsPyz1QKJJZDwAAAABJRU5ErkJggg==" alt="img"  />
Docker —— 从入门到实践</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>girde simple修改添加支持侧边栏目录</title>
      <link>https://blog.yongs.ml/posts/girde-simple-support-for-sidebar-directory/</link>
      <pubDate>Sun, 06 Jun 2021 18:50:26 +0000</pubDate>
      
      <guid>https://blog.yongs.ml/posts/girde-simple-support-for-sidebar-directory/</guid>
      <description>修改主题文件支持侧边栏目录 simple主题整体还行，但文章无侧边栏目录，一般写的技术</description>
      <content:encoded><![CDATA[<p>修改主题文件支持侧边栏目录</p>
<!-- more -->
<p>simple主题整体还行，但文章无侧边栏目录，一般写的技术性文章很长，就需要侧边栏目录和这个功能了，在网上搜了一下资料，对于前端小学生的我费了好长时间才搞定，记录一下过程。</p>
<h3 id="1修改postejs文件">1、修改post.ejs文件</h3>
<p><code>head</code>新增</p>
<p><code>&lt;script src=&quot;https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js&quot;&gt;&lt;/script&gt;</code></p>
<p>搜索<code>&lt;%- post.content %&gt;</code>复制一下代码覆盖copy</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">class</span>=<span style="color:#0ff;font-weight:bold">&#34;post-content-wrapper&#34;</span>&gt;
  &lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">class</span>=<span style="color:#0ff;font-weight:bold">&#34;post-content&#34;</span> <span style="color:#007f7f">v-pre</span>&gt;
    <span style="color:#f00">&lt;</span>%- post.content %&gt;
  &lt;/<span style="font-weight:bold">div</span>&gt;
  &lt;<span style="font-weight:bold">div</span> <span style="color:#007f7f">class</span>=<span style="color:#0ff;font-weight:bold">&#34;toc-container&#34;</span>&gt;
   <span style="color:#f00">&lt;</span>%- post.toc %&gt;
 &lt;/<span style="font-weight:bold">div</span>&gt;
&lt;/<span style="font-weight:bold">div</span>&gt;
</code></pre></div><p>新增高亮js</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">&lt;script&gt;
      hljs.initHighlightingOnLoad()

      <span style="color:#fff;font-weight:bold">let</span> mainNavLinks = <span style="color:#fff;font-weight:bold">document</span>.querySelectorAll(<span style="color:#0ff;font-weight:bold">&#34;.markdownIt-TOC a&#34;</span>);

      <span style="color:#007f7f">// This should probably be throttled.
</span><span style="color:#007f7f"></span>      <span style="color:#007f7f">// Especially because it triggers during smooth scrolling.
</span><span style="color:#007f7f"></span>      <span style="color:#007f7f">// https://lodash.com/docs/4.17.10#throttle
</span><span style="color:#007f7f"></span>      <span style="color:#007f7f">// You could do like...
</span><span style="color:#007f7f"></span>      <span style="color:#007f7f">// window.addEventListener(&#34;scroll&#34;, () =&gt; {
</span><span style="color:#007f7f"></span>      <span style="color:#007f7f">//    _.throttle(doThatStuff, 100);
</span><span style="color:#007f7f"></span>      <span style="color:#007f7f">// });
</span><span style="color:#007f7f"></span>      <span style="color:#007f7f">// Only not doing it here to keep this Pen dependency-free.
</span><span style="color:#007f7f"></span>
      <span style="color:#fff;font-weight:bold">window</span>.addEventListener(<span style="color:#0ff;font-weight:bold">&#34;scroll&#34;</span>, event =&gt; {
        <span style="color:#fff;font-weight:bold">let</span> fromTop = <span style="color:#fff;font-weight:bold">window</span>.scrollY;

        mainNavLinks.forEach((link, index) =&gt; {
          <span style="color:#fff;font-weight:bold">let</span> section = <span style="color:#fff;font-weight:bold">document</span>.getElementById(<span style="color:#fff;font-weight:bold">decodeURI</span>(link.hash).substring(<span style="color:#ff0;font-weight:bold">1</span>));
          <span style="color:#fff;font-weight:bold">let</span> nextSection = <span style="color:#fff;font-weight:bold">null</span>
          <span style="color:#fff;font-weight:bold">if</span> (mainNavLinks[index + <span style="color:#ff0;font-weight:bold">1</span>]) {
            nextSection = <span style="color:#fff;font-weight:bold">document</span>.getElementById(<span style="color:#fff;font-weight:bold">decodeURI</span>(mainNavLinks[index + <span style="color:#ff0;font-weight:bold">1</span>].hash).substring(<span style="color:#ff0;font-weight:bold">1</span>));
          }
          <span style="color:#fff;font-weight:bold">if</span> (section.offsetTop &lt;= fromTop) {
            <span style="color:#fff;font-weight:bold">if</span> (nextSection) {
              <span style="color:#fff;font-weight:bold">if</span> (nextSection.offsetTop &gt; fromTop) {
                link.classList.add(<span style="color:#0ff;font-weight:bold">&#34;current&#34;</span>);
              } <span style="color:#fff;font-weight:bold">else</span> {
                link.classList.remove(<span style="color:#0ff;font-weight:bold">&#34;current&#34;</span>);    
              }
            } <span style="color:#fff;font-weight:bold">else</span> {
              link.classList.add(<span style="color:#0ff;font-weight:bold">&#34;current&#34;</span>);
            }
          } <span style="color:#fff;font-weight:bold">else</span> {
            link.classList.remove(<span style="color:#0ff;font-weight:bold">&#34;current&#34;</span>);
          }
        });
      });

    &lt;<span style="color:#f00">/script&gt;</span>
</code></pre></div><h3 id="2客户端新增自定义css">2、客户端新增自定义css</h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">.toc-container  .markdownIt-TOC {
    <span style="color:#fff;font-weight:bold">position</span>: <span style="color:#fff;font-weight:bold">sticky</span>;
    <span style="color:#fff;font-weight:bold">top</span>: <span style="color:#ff0;font-weight:bold">32</span><span style="color:#fff;font-weight:bold">px</span>;
    <span style="color:#fff;font-weight:bold">width</span>: <span style="color:#ff0;font-weight:bold">200</span><span style="color:#fff;font-weight:bold">px</span>;
    <span style="color:#fff;font-weight:bold">font-size</span>: <span style="color:#ff0;font-weight:bold">12</span><span style="color:#fff;font-weight:bold">px</span>;
    <span style="color:#fff;font-weight:bold">list-style</span>: <span style="color:#fff;font-weight:bold">none</span>;
    <span style="color:#fff;font-weight:bold">padding-left</span>: <span style="color:#ff0;font-weight:bold">0</span>;
    <span style="color:#fff;font-weight:bold">padding</span>: <span style="color:#ff0;font-weight:bold">16</span><span style="color:#fff;font-weight:bold">px</span> <span style="color:#ff0;font-weight:bold">8</span><span style="color:#fff;font-weight:bold">px</span>;
 }
.toc-container  .markdownIt-TOC:before {
      <span style="color:#fff;font-weight:bold">content</span>: <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>;
      <span style="color:#fff;font-weight:bold">position</span>: <span style="color:#fff;font-weight:bold">absolute</span>;
      <span style="color:#fff;font-weight:bold">top</span>: <span style="color:#ff0;font-weight:bold">0</span>;
      <span style="color:#fff;font-weight:bold">left</span>: <span style="color:#ff0;font-weight:bold">8</span><span style="color:#fff;font-weight:bold">px</span>;
      <span style="color:#fff;font-weight:bold">bottom</span>: <span style="color:#ff0;font-weight:bold">0</span>;
      <span style="color:#fff;font-weight:bold">width</span>: <span style="color:#ff0;font-weight:bold">1</span><span style="color:#fff;font-weight:bold">px</span>;
      <span style="color:#fff;font-weight:bold">background-color</span>: <span style="color:#ff0;font-weight:bold">#ebedef</span>;
      <span style="color:#fff;font-weight:bold">opacity</span>: <span style="color:#ff0;font-weight:bold">.5</span>;
  }
.toc-container  <span style="font-weight:bold">ul</span> {
    <span style="color:#fff;font-weight:bold">list-style</span>: <span style="color:#fff;font-weight:bold">none</span>;
  }
.toc-container  <span style="font-weight:bold">li</span> {
    <span style="color:#fff;font-weight:bold">padding-left</span>: <span style="color:#ff0;font-weight:bold">16</span><span style="color:#fff;font-weight:bold">px</span>;
}
.toc-container  <span style="font-weight:bold">li</span> <span style="font-weight:bold">a</span> {
      <span style="color:#fff;font-weight:bold">color</span>: <span style="color:#ff0;font-weight:bold">#868e96</span>;
      <span style="color:#fff;font-weight:bold">padding</span>: <span style="color:#ff0;font-weight:bold">4</span><span style="color:#fff;font-weight:bold">px</span>;
      <span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">block</span>;
      <span style="color:#fff;font-weight:bold">transition</span>: <span style="color:#fff;font-weight:bold">all</span> <span style="color:#ff0;font-weight:bold">0.3</span><span style="color:#fff;font-weight:bold">s</span>;
  }
.toc-container  <span style="font-weight:bold">li</span> <span style="font-weight:bold">a</span>:hover {
        <span style="color:#fff;font-weight:bold">background</span>: <span style="color:#ff0;font-weight:bold">#cddbef</span>;
      }
.toc-container  <span style="font-weight:bold">li</span> <span style="font-weight:bold">a</span>.current {
        <span style="color:#fff;font-weight:bold">color</span>: <span style="color:#ff0;font-weight:bold">#006CFF</span>;
        <span style="color:#fff;font-weight:bold">background</span>: <span style="color:#ff0;font-weight:bold">#fafafa</span>;
  }
.post-content-wrapper {
<span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">flex</span>;
}
.post-content {
<span style="color:#fff;font-weight:bold">width</span>: <span style="color:#ff0;font-weight:bold">100</span><span style="color:#fff;font-weight:bold">%</span>;
<span style="color:#fff;font-weight:bold">margin-right</span>: <span style="color:#ff0;font-weight:bold">20</span><span style="color:#fff;font-weight:bold">px</span>;
}
@<span style="color:#fff;font-weight:bold">media</span> (<span style="font-weight:bold">max-width</span>: <span style="font-weight:bold">1150px</span>) {
  .toc-container {
    <span style="color:#fff;font-weight:bold">display</span>: <span style="color:#fff;font-weight:bold">none</span>;
  }
}
</code></pre></div><h3 id="3修改maincss文件">3、修改main.css文件</h3>
<p>搜索<code>.post-detail</code> 修改<code>margin: 0 auto;</code>为</p>
<p><code>margin: 0 20px;</code></p>
<p>重新渲染网页即可尽情享用吧！</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>云服务器docker搭建自动领京豆bot互动指令</title>
      <link>https://blog.yongs.ml/posts/docker-build-jdbot/</link>
      <pubDate>Fri, 30 Apr 2021 22:49:08 +0000</pubDate>
      
      <guid>https://blog.yongs.ml/posts/docker-build-jdbot/</guid>
      <description>使用docker部署自动领金豆bot脚本 使用的版本： 服务器：centos 8 docke</description>
      <content:encoded><![CDATA[<p>使用docker部署自动领金豆bot脚本</p>
<!-- more -->
<p>使用的版本：</p>
<p>服务器：centos 8</p>
<p>docker： 20.10.6</p>
<p>docker-compose： 1.27.4</p>
<h3 id="1服务器安装dockerdocker-compose">1、服务器安装docker，docker-compose</h3>
<p>推荐使用centos服务器安装docker、docker-compose</p>
<p>Docker安装</p>
<ul>
<li>国内一键安装 <code>curl -sSL https://get.daocloud.io/docker | sh</code></li>
<li>国外一键安装 <code>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</code></li>
</ul>
<p>docker-compose安装</p>
<p><code>$ sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</code></p>
<p>要安装其他版本的 Compose，请替换 1.24.1。</p>
<p>最新发行的版本地址：https://github.com/docker/compose/releases。</p>
<p>将可执行权限应用于二进制文件：</p>
<p><code>$ sudo chmod +x /usr/local/bin/docker-compose</code></p>
<p>创建软链：</p>
<p><code>$ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</code></p>
<p>通过<code>docker-compose version</code>查看<code>docker-compose</code>版本，确认是否安装成功。</p>
<h3 id="2安装jd_scripts">2、安装jd_scripts</h3>
<p>创建一个目录<code>jd_scripts</code>用于存放备份配置等数据，迁移重装的时候只需要备份整个jd_scripts目录即可</p>
<p>需要新建的目录文件结构参考如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">jd_scripts
├── logs
│   ├── XXXX.log
│   └── XXXX.log
├── my_crontab_list.sh
└── docker-compose.yml
</code></pre></div><ul>
<li><code>jd_scripts/logs</code>建一个空文件夹就行</li>
<li><code>jd_scripts/docker-compose.yml</code> 参考内容如下(自己动手能力不行搞不定请使用默认配置)：</li>
</ul>
<p>根据文档一步一步下去就ok了，下面主要记录下可能用到的命令</p>
<p>目录文件配置好之后在 <code>jd_scripts</code>目录执行。<br>
<code>docker-compose up -d</code> 启动（修改docker-compose.yml后需要使用此命令使更改生效）；<br>
<code>docker-compose logs</code> 打印日志；<br>
<code>docker-compose logs -f</code> 打印日志，-f表示跟随日志；
<code>docker logs -f jd_scripts</code> 和上面两条相比可以显示汉字；
<code>docker-compose pull</code> 更新镜像；<br>
<code>docker-compose stop</code> 停止容器；<br>
<code>docker-compose restart</code> 重启容器；<br>
<code>docker-compose down</code> 停止并删除容器；</p>
<h3 id="3开代理机器激活tg-bot">3、开代理机器，激活tg-bot</h3>
<p>这里是个大坑，拿个小本本记下来，其实就是docker内代理宿主机代理的问题</p>
<p>由于众所周知的原因，国内的机器不能访问tg，而又想使用tg-bot来控制，无奈，国外机子太贵（穷），最低也要5美刀！遂买国内机子开代理使用</p>
<h5 id="1买国内机器推荐大厂的">1、买国内机器，推荐大厂的</h5>
<p>这里应该放各大厂的aff的，留个坑</p>
<h5 id="2安装clash">2、安装clash</h5>
<p>一直在使用clash，直接网上搜索clash<a href="https://github.com/Dreamacro/clash/releases">下载</a>，找到对应版本下载，博主用的是centos，下载linux-amd64的</p>
<p>1、下载clash，最新版本可去官网找</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">wget https://github.com/Dreamacro/clash/releases/download/v0.19.0/clash-linux-amd64-v0.19.0.gz
</code></pre></div><p>2、解压</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">gzip -d clash-linux-amd64-v0.19.0.gz
</code></pre></div><p>3、移动至usr/bin/clash并重命名为clash</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo mv clash-linux-amd64-v0.19.0 /usr/bin/clash
</code></pre></div><p>4、赋予clash运行权限</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo chmod +x /usr/bin/clash
</code></pre></div><p>5、检查是否安装成功</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">clash -v 
</code></pre></div><h5 id="3创建配置文件安装控制面板">3、创建配置文件、安装控制面板</h5>
<p>1.创建配置文件目录</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mkdir -p /etc/clash/
</code></pre></div><p>2.进入目录</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#fff;font-weight:bold">cd</span> /etc/clash/
</code></pre></div><p>3.创建配置文件</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim config.yaml
</code></pre></div><p>4.手动编辑很麻烦，可用winscp上传</p>
<p>配置参数自行查找</p>
<p>5.下载前端代码</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">wget https://github.com/Dreamacro/clash-dashboard/tree/gh-pages
</code></pre></div><p>6.解压</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">unzip gh-pages.zip
</code></pre></div><p>7.修改目录名,这里的目录名是上面配置文件里的 external-ui: dashboard</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mv clash-dashboard-gh-pages dashboard
</code></pre></div><p><a href="http://clash.razord.top/">可用这个面板远程控制</a></p>
<h5 id="4设置clash开机启动">4、设置clash开机启动</h5>
<p>1.创建service文件</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo vim /usr/lib/systemd/system/clash.service
</code></pre></div><p>2.输入下面代码</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">[Unit]
Description=clash proxy
After=network.target

[Service]
Type=simple
ExecStart=/usr/bin/clash -d /etc/clash

[Install]
WantedBy=multi-user.target
</code></pre></div><p>3.重新加载 systemd 模块</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo systemctl daemon-reload
</code></pre></div><p>4.启动Clash</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo systemctl start clash.service
</code></pre></div><p>5.设置Clash开机自启动</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo systemctl <span style="color:#fff;font-weight:bold">enable</span> clash.service
</code></pre></div><p>6.判断是否成功开启代理</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">curl -I https://www.google.com
</code></pre></div><p>返回200即表示代理已经成功</p>
<h5 id="5自动更新订阅配置文件">5、自动更新订阅配置文件</h5>
<blockquote>
<p>通过shell脚本自动更新Clash在线配置</p>
</blockquote>
<p>通过systemctl来管理Clash的进程，对应<code>clash.service</code>文件，通过两个脚本<code>start-clash.sh</code>和<code>stop-clash.sh</code>来管理Clash的启停：</p>
<p>把上面的配置文件修改下：</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim /usr/lib/systemd/system/clash.service
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">[Unit]
Description=clash proxy
After=network.target

[Service]
WorkingDirectory=/当前用户目录/.config/clash
Type=simple
ExecStart=/当前用户目录/.config/clash/start-clash.sh
ExecStop=/当前用户目录/.config/clash/stop-clash.sh
Environment=<span style="color:#0ff;font-weight:bold">&#34;HOME=/当前用户目录&#34;</span>
Environment=<span style="color:#0ff;font-weight:bold">&#34;CLASH_URL=你的订阅链接&#34;</span>

[Install]
WantedBy=multi-user.target

</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim /当前用户目录/.config/clash/start-clash.sh
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#0f0;font-weight:bold">#!/bin/bash
</span><span style="color:#0f0;font-weight:bold"></span><span style="color:#007f7f"># save this file to ${HOME}/.config/clash/start-clash.sh</span>

<span style="color:#007f7f"># save pid file</span>
<span style="color:#fff;font-weight:bold">echo</span> $$ &gt; <span style="color:#0ff;font-weight:bold">${</span>HOME<span style="color:#0ff;font-weight:bold">}</span>/.config/clash/clash.pid

diff <span style="color:#0ff;font-weight:bold">${</span>HOME<span style="color:#0ff;font-weight:bold">}</span>/.config/clash/config.yaml &lt;(curl -s <span style="color:#0ff;font-weight:bold">${</span>CLASH_URL<span style="color:#0ff;font-weight:bold">}</span>)
<span style="color:#fff;font-weight:bold">if</span> [ <span style="color:#0ff;font-weight:bold">&#34;</span>$?<span style="color:#0ff;font-weight:bold">&#34;</span> == <span style="color:#ff0;font-weight:bold">0</span> ]
<span style="color:#fff;font-weight:bold">then</span>
    /usr/bin/clash
<span style="color:#fff;font-weight:bold">else</span>
    TIME=<span style="color:#0ff;font-weight:bold">`</span>date <span style="color:#0ff;font-weight:bold">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style="color:#0ff;font-weight:bold">`</span>
    cp <span style="color:#0ff;font-weight:bold">${</span>HOME<span style="color:#0ff;font-weight:bold">}</span>/.config/clash/config.yaml <span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">${</span>HOME<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">/.config/clash/config.yaml.bak</span><span style="color:#0ff;font-weight:bold">${</span>TIME<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">&#34;</span>
    curl -L -o <span style="color:#0ff;font-weight:bold">${</span>HOME<span style="color:#0ff;font-weight:bold">}</span>/.config/clash/config.yaml <span style="color:#0ff;font-weight:bold">${</span>CLASH_URL<span style="color:#0ff;font-weight:bold">}</span>
    /usr/bin/clash
<span style="color:#fff;font-weight:bold">fi</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim /当前用户目录/.config/clash/stop-clash.sh
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#0f0;font-weight:bold">#!/bin/bash
</span><span style="color:#0f0;font-weight:bold"></span><span style="color:#007f7f"># save this file to ${HOME}/.config/clash/stop-clash.sh</span>

<span style="color:#007f7f"># read pid file</span>
PID=<span style="color:#0ff;font-weight:bold">`</span>cat <span style="color:#0ff;font-weight:bold">${</span>HOME<span style="color:#0ff;font-weight:bold">}</span>/.config/clash/clash.pid<span style="color:#0ff;font-weight:bold">`</span>
<span style="color:#fff;font-weight:bold">kill</span> -9 <span style="color:#0ff;font-weight:bold">${</span>PID<span style="color:#0ff;font-weight:bold">}</span>
rm <span style="color:#0ff;font-weight:bold">${</span>HOME<span style="color:#0ff;font-weight:bold">}</span>/.config/clash/clash.pid
</code></pre></div><p>配置添加完成后，如果你的clash 正在运行中，需要重新加载配置文件并重启</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ systemctl daemon-reload
$ sudo systemctl restart clash.service
</code></pre></div><p>这样每次启动clash时就会自动更新配置文件了，接下来通过crontab 自动重启 clash.service实现自动更新节点</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#007f7f">#新建shell文件</span>
vim restart-clash.sh
</code></pre></div><p>新增一条命令</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#007f7f">#/bin/sh</span>
sudo systemctl restart clash.service

</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">chmod +x restart-clash.sh
crontab -e
<span style="color:#007f7f">#插入下面命令</span>
<span style="color:#007f7f">#每3小时重启一次</span>
<span style="color:#ff0;font-weight:bold">0</span> */3 * * * restart-clash.sh
<span style="color:#007f7f">#每分钟重启一次</span>
* * * * * restart-clash.sh
</code></pre></div><p>大功告成，可通过<code>tail -500f /var/log/cron</code>查看定时任务是否执行</p>
<p><code>sudo systemctl status clash.service</code>  查看是否重启成功</p>
<h3 id="4docker内开代理">4、docker内开代理</h3>
<p>由于主要用来使用tg-bot，故只检测tgapi即可</p>
<p>1、判断宿主机可连接tgapi</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">curl -sX POST <span style="color:#0ff;font-weight:bold">&#34;https://api.telegram.org/bot&#39;&#39;&#39;Your Token&#39;&#39;&#39;/sendMessage&#34;</span> -d <span style="color:#0ff;font-weight:bold">&#34;chat_id=&#34;</span>Some Chat id<span style="color:#0ff;font-weight:bold">&#34;&amp;text=hello&#34;</span>

curl -sX POST <span style="color:#0ff;font-weight:bold">&#34;https://api.telegram.org/botxxxxxxxxugt5A/sendMessage&#34;</span> -d <span style="color:#0ff;font-weight:bold">&#34;chat_id=48xxxxxx&amp;text=hello&#34;</span>
</code></pre></div><p>如果返回成功，即表示成功</p>
<p>2、进入容器</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker <span style="color:#fff;font-weight:bold">exec</span> -it jd_scripts /bin/sh
</code></pre></div><p>执行步骤1命令，如若响应时间长或失败，则需要配置代理</p>
<p>3、配置容器代理走宿主机</p>
<p><a href="https://docs.docker.com/network/proxy/#use-environment-variables">docker官方有教程</a></p>
<p>docker版本大于 17.07以上可用下面的方法</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#fff;font-weight:bold">cd</span>
mkdir .docker
vim  ~/.docker/config.json

</code></pre></div><p>填入下面json</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
 <span style="font-weight:bold">&#34;proxies&#34;</span>:
 {
   <span style="font-weight:bold">&#34;default&#34;</span>:
   {
     <span style="font-weight:bold">&#34;httpProxy&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;http://172.17.0.1:7890&#34;</span>,
     <span style="font-weight:bold">&#34;httpsProxy&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;http://172.17.0.1:7890&#34;</span>,
     <span style="font-weight:bold">&#34;noProxy&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;localhost,127.0.0.1&#34;</span>
<span style="color:#f00">&#34;</span>
   }
 }
}
</code></pre></div><p>保存文件<strong>创建或者启动新容器时才生效</strong></p>
<p>这里有个大坑，搞了一天，就是</p>
<p><strong>代理的ip一定要写对！</strong></p>
<p><strong>代理的ip一定要写对！</strong></p>
<p><strong>代理的ip一定要写对!</strong></p>
<blockquote>
<p>下午调试的时候https的写成了127的了，机器启动起来，pull代码的时候，直接找不到文件，当时还骂这破代理，没法，就把报错ip不走代理了，没想到下面不报错了，直接无限重启，搞得头都大了，还在想是不是内存爆了呢！晚上，打开配置文件，定睛一看，WC！&ldquo;httpsProxy&quot;端口写的127&hellip;赶紧改了，重新跑遍，妥了，bot成功了！</p>
</blockquote>
<p>4、删除容器，重新启用</p>
<p>接下来在jd_scripts 目录内</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker-compose down
docker-compose up -d
</code></pre></div><p>启动成功后，tgbot即可收到成功的消息，尽情享用吧！</p>
<h3 id="clash相关的管理命令">Clash相关的管理命令</h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#007f7f">## 启动Clash ##</span>
sudo systemctl start clash.service

<span style="color:#007f7f">## 重启Clash ##</span>
sudo systemctl restart clash.service

<span style="color:#007f7f">## 查看Clash运行状态 ##</span>
sudo systemctl status clash.service

<span style="color:#007f7f">## 实时滚动状态 ##</span>
sudo journalctl -u clash.service -f
</code></pre></div><h3 id="docker相关命令">docker相关命令</h3>
<p><code>docker exec -it jd_scripts /bin/sh -c 'git -C /scripts pull &amp;&amp; node /scripts/jd_bean_change.js'</code>  手动运行一脚本</p>
<p><code>docker exec -it jd_scripts /bin/sh -c 'env'</code>  查看设置的环境变量</p>
<p><code>docker exec -it jd_scripts /bin/sh -c 'crontab -l'</code>  查看已生效的crontab_list定时器任务</p>
<p><code>docker exec -it jd_scripts sh -c &quot;docker_entrypoint.sh&quot;</code> 手动更新jd_scripts仓库最新脚本</p>
<p><code>docker exec -it jd_scripts /bin/sh</code> 仅进入容器命令</p>
<p><code>rm -rf  logs/*.log</code> 删除logs文件夹里面所有的日志文件</p>
<ul>
<li>[1] <a href="https://github.com/wisz2021/jd_docker">jd_docker</a></li>
<li>[2] <a href="https://github.com/yuanlam/Clash-Linux">clash安装参考</a></li>
<li>[3] <a href="https://kebingzao.com/2019/02/22/docker-container-proxy/">docker内代理参考</a></li>
<li>[4] <a href="https://akillcool.github.io/post/clash-with-auto-update-config/">clash自动更新订阅配置</a></li>
</ul>
]]></content:encoded>
    </item>
    
    
    
  </channel>
</rss>
