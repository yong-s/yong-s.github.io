<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>web on å¼ ä¸‰çš„ç½‘ç»œæ—¥å¿—</title>
    <link>https://blog.zsan.ml/tags/web/</link>
    <description>Recent content in web on å¼ ä¸‰çš„ç½‘ç»œæ—¥å¿—</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh&#34; target=&#34;_blank&#34;&gt;CC BY-NC-SA 4.0&lt;/a&gt;</copyright>
    <lastBuildDate>Sun, 07 Aug 2022 16:28:27 +0800</lastBuildDate><atom:link href="https://blog.zsan.ml/tags/web/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>ç”¨PWA æ”¹é€ WEB ä¸ºåŸç”ŸApp</title>
      <link>https://blog.zsan.ml/posts/pwa-retrofitting/</link>
      <pubDate>Sun, 07 Aug 2022 16:28:27 +0800</pubDate>
      
      <guid>https://blog.zsan.ml/posts/pwa-retrofitting/</guid>
      <description>PWAä½¿WEBç½‘ç«™æ›´ä¸æ»‘</description>
      <content:encoded><![CDATA[<blockquote>
<p>æœ€è¿‘é—²æ¥æ— äº‹ï¼ŒæŠŠç½‘ç«™å‡çº§äº†ï¼Œæ›´åŠ åƒåŸç”ŸAPP</p>
<p>è®°å½•ä¸‹å‡çº§è¿‡ç¨‹ï¼Œå…å¾—ä»¥åå¿˜äº†</p>
<p>PWAæ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥å»ç½‘ä¸Šæœä¸€ä¸‹ï¼Œbutä¸­æ–‡æ–‡ç« å°‘ä¸€ç‚¹</p>
<p>ç”¨Google å°è£…çš„ å¥½çš„ workbox æ¥å‡çº§</p>
</blockquote>
<h2 id="æ³¨å†Œservice-worker">æ³¨å†ŒService Worker</h2>
<p>åœ¨htmlé¡µé¢æ³¨å†Œ SW</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#39;serviceWorker&#39;</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">navigator</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">navigator</span>.<span style="color:#a6e22e">serviceWorker</span>.<span style="color:#a6e22e">getRegistrations</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">regs</span> =&gt; {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">reg</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">regs</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// æ³¨é”€æ‰ä¸æ˜¯å½“å‰ä½œç”¨åŸŸçš„æ‰€æœ‰çš„ Service Worker
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                     <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">reg</span>.<span style="color:#a6e22e">scope</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;http://localhost:8000/&#39;</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">reg</span>.<span style="color:#a6e22e">unregister</span>()
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// æ³¨é”€æ‰æ±¡æŸ“ Service Worker ä¹‹åå†é‡æ–°æ³¨å†Œè‡ªå·±ä½œç”¨åŸŸçš„ Service Worker
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;load&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">navigator</span>.<span style="color:#a6e22e">serviceWorker</span>.<span style="color:#a6e22e">register</span>(<span style="color:#e6db74">&#39;./sw.js&#39;</span>).<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">e</span>) { <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;æ”¯æŒsw:&#34;</span>, <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">scope</span>) })
</span></span><span style="display:flex;"><span>                })
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span></code></pre></div><h2 id="ç”Ÿæˆswjsæ–‡ä»¶">ç”ŸæˆSW.jsæ–‡ä»¶</h2>
<h3 id="google-cdn">google cdn</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">importScripts</span>(<span style="color:#e6db74">&#34;  &#39;https://storage.googleapis.com/workbox-cdn/releases/6.1.1/workbox-sw.js&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>);
</span></span></code></pre></div><p>å›½å†…å»ºè®®ä¸ä½¿ç”¨Google</p>
<h3 id="jsdelivr-cdn">jsdelivr cdn</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">importScripts</span>(<span style="color:#e6db74">&#34;https://fastly.jsdelivr.net/npm/workbox-sw@6.5.4/build/workbox-sw.min.js&#34;</span>);
</span></span></code></pre></div><h2 id="swjs-ç¼–å†™">SW.js ç¼–å†™</h2>
<h3 id="é…ç½®ç›¸å…³">é…ç½®ç›¸å…³</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">setConfig</span>(
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æ˜¯å¦å¼€å¯debug
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">debug</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">cacheSuffixVersion</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;-220806&#39;</span>; <span style="color:#75715e">// ç¼“å­˜ç‰ˆæœ¬å·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">maxEntries</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>; <span style="color:#75715e">// æœ€å¤§æ¡ç›®æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">setCacheNameDetails</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">prefix</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;zsan&#39;</span>, <span style="color:#75715e">// å‰ç¼€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">suffix</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cacheSuffixVersion</span>, <span style="color:#75715e">// åç¼€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">workbox</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Yay! Workbox is loaded ğŸ‰&#34;</span>)
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Boo! Workbox didn&#39;t load ğŸ˜¬&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="é¢„ç¼“å­˜æ–‡ä»¶">é¢„ç¼“å­˜æ–‡ä»¶</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">cacheFiles</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/index.html&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">revision</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cacheSuffixVersion</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">precaching</span>.<span style="color:#a6e22e">precacheAndRoute</span>(<span style="color:#a6e22e">cacheFiles</span>);
</span></span></code></pre></div><h2 id="workboxç­–ç•¥">workboxç­–ç•¥</h2>
<h3 id="cdnç­–ç•¥">cdnç­–ç•¥</h3>
<p>å¯¹äºä¸€äº›cdnçš„ä½¿ç”¨ï¼Œä½¿ç”¨CacheFirst ç¼“å­˜ä¼˜å…ˆç­–ç•¥ï¼Œæ­¤ç­–ç•¥å°†é¦–å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦æœ‰å“åº”ï¼Œå¦‚æœæœ‰å“åº”ï¼Œåˆ™ä½¿ç”¨è¯¥ç­–ç•¥ã€‚å¦‚æœè¯·æ±‚ä¸åœ¨ç¼“å­˜ä¸­ï¼Œåˆ™å°†ä½¿ç”¨ç½‘ç»œï¼Œå¹¶å°†ä»»ä½•æœ‰æ•ˆå“åº”æ·»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åå†ä¼ é€’ç»™æµè§ˆå™¨ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">routing</span>.<span style="color:#a6e22e">registerRoute</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> RegExp(<span style="color:#e6db74">&#39;^https://fastly\\.jsdelivr\\.net&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">strategies</span>.<span style="color:#a6e22e">CacheFirst</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cacheName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;static-immutable&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cacheSuffixVersion</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fetchOptions</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;cors&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">credentials</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;omit&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">expiration</span>.<span style="color:#a6e22e">ExpirationPlugin</span>({
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">maxAgeSeconds</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">30</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">purgeOnQuotaError</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="å­—ä½“æ–‡ä»¶">å­—ä½“æ–‡ä»¶</h3>
<p>å¯¹äºå­—ä½“æ–‡ä»¶ï¼ŒåŸºæœ¬ä¸Šç¡®å®šå¥½å°±ä¸ä¼šæ”¹åŠ¨äº†ï¼Œè¿™é‡Œä½¿ç”¨StaleWhileRevalidateï¼Œæ­¤ç­–ç•¥å°†å¯¹ç½‘ç»œè¯·æ±‚ä½¿ç”¨ç¼“å­˜æ¥å“åº”ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå¹¶åœ¨åå°æ›´æ–°ç¼“å­˜ã€‚å¦‚æœæœªç¼“å­˜ï¼Œå®ƒå°†ç­‰å¾…ç½‘ç»œå“åº”å¹¶ä½¿ç”¨å®ƒã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">routing</span>.<span style="color:#a6e22e">registerRoute</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// åŒ¹é… woff å­—ä½“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">new</span> RegExp(<span style="color:#e6db74">&#39;.*.woff&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">strategies</span>.<span style="color:#a6e22e">StaleWhileRevalidate</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// cache storage åç§°å’Œç‰ˆæœ¬å·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">cacheName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;font-cache&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cacheSuffixVersion</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ä½¿ç”¨ expiration æ’ä»¶å®ç°ç¼“å­˜æ¡ç›®æ•°ç›®å’Œæ—¶é—´æ§åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">expiration</span>.<span style="color:#a6e22e">ExpirationPlugin</span>({
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// æœ€å¤§ä¿å­˜é¡¹ç›®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#a6e22e">maxEntries</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// ç¼“å­˜ 30 å¤©
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#a6e22e">maxAgeSeconds</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">30</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>,
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ä½¿ç”¨ cacheableResponse æ’ä»¶ç¼“å­˜çŠ¶æ€ç ä¸º 0 çš„è¯·æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">cacheableResponse</span>.<span style="color:#a6e22e">CacheableResponsePlugin</span>({
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">statuses</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">200</span>],
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="apièµ„æº">APIèµ„æº</h3>
<p>APIæ•°æ®çš„è¯·æ±‚ä½¿ç”¨NetworkFirst ç­–ç•¥ï¼Œæ­¤ç­–ç•¥å°†å°è¯•é¦–å…ˆä»ç½‘ç»œè·å¾—å“åº”ã€‚å¦‚æœæ”¶åˆ°å“åº”ï¼Œå®ƒå°†æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚å¦‚æœç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ€åä¸€ä¸ªç¼“å­˜çš„å“åº”ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">routing</span>.<span style="color:#a6e22e">registerRoute</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// åŒ¹é… leancloudapi.xsbb.ml
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">new</span> RegExp(<span style="color:#e6db74">&#39;^https://(?:blog\\.zsan\\.ml)&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">strategies</span>.<span style="color:#a6e22e">NetworkFirst</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// cache storage åç§°å’Œç‰ˆæœ¬å·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">cacheName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;blog-api-cache&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cacheSuffixVersion</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fetchOptions</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;cors&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">credentials</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;omit&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">networkTimeoutSeconds</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="google-analytics">Google-Analytics</h3>
<p>å®˜æ–¹æœ‰<a href="https://developers.google.com/web/tools/workbox/guides/enable-offline-analytics">Google Analytics ç¦»çº¿ç»Ÿè®¡æ’ä»¶</a>,ä½†æ˜¯è‹±æ–‡çš„ï¼Œç›¸å…³èµ„æ–™ä¹Ÿå°‘ï¼ŒæŠ˜è…¾äº†å¥½ä¸€é˜µå­</p>
<p>1ã€ç®€å•ç‚¹ï¼Œä¸€å¥ä»£ç å°±è¡Œ,æ³¨æ„ç”¨è¿™ä¸ªæ—¶å€™ï¼Œheadé‡Œçš„ä»£ç éœ€è¦æ˜¯å®˜æ–¹è·å–çš„æœ€æ–°çš„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">googleAnalytics</span>.<span style="color:#a6e22e">initialize</span>()
</span></span></code></pre></div><p>2ã€å¸¦ç¦»çº¿ç»Ÿè®¡</p>
<p>éœ€è¦å»Google analytics æ·»åŠ è‡ªå®šä¹‰æŒ‡æ ‡å’Œè‡ªå®šä¹‰ç»´åº¦</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">googleAnalytics</span>.<span style="color:#a6e22e">initialize</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">parameterOverrides</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cd1</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;offline&#39;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hitFilter</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">params</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">queueTimeInSeconds</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;qt&#39;</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;cm1&#39;</span>, <span style="color:#a6e22e">queueTimeInSeconds</span>);
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h3 id="å…¶ä»–åç¼€åŒ¹é…">å…¶ä»–åç¼€åŒ¹é…</h3>
<p>ä¿è¯ä½“éªŒè‰¯å¥½</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">routing</span>.<span style="color:#a6e22e">registerRoute</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> RegExp(<span style="color:#e6db74">&#39;.*.(?:png|jpg|jpeg|svg|gif|webp|ico)&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">strategies</span>.<span style="color:#a6e22e">StaleWhileRevalidate</span>()
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">routing</span>.<span style="color:#a6e22e">registerRoute</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> RegExp(<span style="color:#e6db74">&#39;.*.(css|js)&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">strategies</span>.<span style="color:#a6e22e">StaleWhileRevalidate</span>()
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// é»˜è®¤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">routing</span>.<span style="color:#a6e22e">setDefaultHandler</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">workbox</span>.<span style="color:#a6e22e">strategies</span>.<span style="color:#a6e22e">NetworkFirst</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">networkTimeoutSeconds</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>æ”¹é€ å®Œæˆï¼Œå°½æƒ…äº«ç”¨ğŸ‰</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<blockquote>
<p><a href="https://blog.baoshuo.ren/post/workbox-service-worker/">åˆè¯† Service Worker â€”â€” ä½¿ç”¨ Workbox å¿«é€Ÿå¼€å‘ Service Worker - å®ç¡•åšå®¢</a></p>
<p><a href="https://pwa.alienzhou.com/">PWAæ¥äº†ï¼Œä½ å‡†å¤‡å¥½äº†ä¹ˆï¼Ÿ - PWAå­¦ä¹ æ‰‹å†Œ</a></p>
<p><a href="https://lavas-project.github.io/pwa-book/">HOME Â· PWA åº”ç”¨å®æˆ˜</a></p>
<p><a href="https://developer.chrome.com/docs/workbox/service-worker-overview/">Service worker overview - Chrome Developers</a></p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>Docker éƒ¨ç½² NginxæœåŠ¡</title>
      <link>https://blog.zsan.ml/posts/docker-build-nginx/</link>
      <pubDate>Fri, 08 Apr 2022 16:23:01 +0800</pubDate>
      
      <guid>https://blog.zsan.ml/posts/docker-build-nginx/</guid>
      <description>ç”¨dockeréƒ¨ç½²nginxå®˜æ–¹åªç»™äº†dockerç‰ˆæœ¬çš„ï¼Œæ²¡æœ‰composeçš„ï¼Œåªå¥½</description>
      <content:encoded><![CDATA[<blockquote>
<p>ç”¨dockeréƒ¨ç½²nginxå®˜æ–¹åªç»™äº†dockerç‰ˆæœ¬çš„ï¼Œæ²¡æœ‰composeçš„ï¼Œåªå¥½è‡ªå·±è½¬æ¢ä¸€ä¸‹äº†ï¼Œè®°å½•ä¸€ä¸‹ï¼Œæ–¹ä¾¿ä¸‹æ¬¡éƒ¨ç½²ï¼Œè¿™åªæ˜¯ç®€å•çš„éƒ¨ç½²ï¼Œè‡³äºnginxé…ç½®çš„è¯ï¼Œæœ‰ç©ºå†è¡¥å§ğŸ« </p>
</blockquote>
<h2 id="1åˆ›å»ºdocker-nginxç›®å½•">1ã€åˆ›å»ºdocker-nginxç›®å½•</h2>
<p>æ–°å»º docker-compose.yml æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir docker-nginx
</span></span><span style="display:flex;"><span>mkdir nginx
</span></span><span style="display:flex;"><span>mkdir log
</span></span><span style="display:flex;"><span>mkdir html
</span></span><span style="display:flex;"><span>vim docker-compose.yml
</span></span></code></pre></div><h2 id="2docker-composeyml">2ã€docker-compose.yml</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3.3&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">web</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:latest</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">./nginx:/etc/nginx</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">./log:/var/log/nginx</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">./html:/usr/share/nginx/html  //ç½‘ç«™æ”¾ç½®ç›®å½•</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#e6db74">&#34;8081:80&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">NGINX_HOST=&#34;192.168.116.10&#34; //è®¿é—®åœ°å€/åŸŸå</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">NGINX_PORT=&#34;80&#34; //è®¿é—®ç«¯å£</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">TZ=&#34;Asia/Shanghai&#34; //æ—¶åŒº</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span></code></pre></div><h2 id="3æ‰‹åŠ¨cpé…ç½®æ–‡ä»¶">3ã€æ‰‹åŠ¨cpé…ç½®æ–‡ä»¶</h2>
<p>ç”±äºå®˜æ–¹imageæ²¡æœ‰é»˜è®¤æ˜ å°„å¤–éƒ¨æ–‡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨æŠŠé…ç½®æ–‡ä»¶cpå‡ºæ¥</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿è¡Œå®˜æ–¹å‘½ä»¤åˆ›å»ºé»˜è®¤å®¹å™¨</span>
</span></span><span style="display:flex;"><span>docker run --name nginx -p 8080:80 -d nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°nginxé‡Œ,å…¶ä»–æ–‡ä»¶å¯ç”¨å¤åˆ¶</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ˜¯ä¸ªå‘ï¼Œè·¯å¾„å¿…é¡»æ˜¯å…¨è·¯å¾„</span>
</span></span><span style="display:flex;"><span>docker cp nginx:/etc/nginx /opt/docker-nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ é™¤é»˜è®¤å®¹å™¨</span>
</span></span><span style="display:flex;"><span>docker stop nginx <span style="color:#f92672">&amp;&amp;</span> docker rm nginx
</span></span></code></pre></div><h2 id="4ä¿®æ”¹nginxé…ç½®æ–‡ä»¶">4ã€ä¿®æ”¹nginxé…ç½®æ–‡ä»¶</h2>
<p>ç«¯å£å·ã€åŸŸåï¼Œsslç­‰å’Œä»¥å‰é…ç½®ä¸€æ ·ï¼Œä¸å†èµ˜è¿°</p>
<h2 id="5è¿è¡Œæµ‹è¯•">5ã€è¿è¡Œ&amp;æµ‹è¯•</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker-compose up -d
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æŸ¥çœ‹æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>docker-compose logs -f     
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æµè§ˆå™¨è¾“å…¥IPæˆ–åŸŸåæŸ¥çœ‹æ˜¯å¦å¯ä»¥è®¿é—®</span>
</span></span></code></pre></div><hr>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<blockquote>
<p>1ã€<a href="https://hub.docker.com/_/nginx">Docker Hub-nginx</a></p>
</blockquote>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
