<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>è„šæœ¬ on å¼ ä¸‰çš„ç½‘ç»œæ—¥å¿—</title>
    <link>https://blog.zsan.cf/tags/%E8%84%9A%E6%9C%AC/</link>
    <description>Recent content in è„šæœ¬ on å¼ ä¸‰çš„ç½‘ç»œæ—¥å¿—</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh&#34; target=&#34;_blank&#34;&gt;CC BY-NC-SA 4.0&lt;/a&gt;</copyright>
    <lastBuildDate>Sun, 26 Jun 2022 15:08:44 +0800</lastBuildDate><atom:link href="https://blog.zsan.cf/tags/%E8%84%9A%E6%9C%AC/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Autojs ç¬”è®°</title>
      <link>https://blog.zsan.cf/posts/autojs-notes/</link>
      <pubDate>Sun, 26 Jun 2022 15:08:44 +0800</pubDate>
      
      <guid>https://blog.zsan.cf/posts/autojs-notes/</guid>
      <description>ç”¨autojsåœ¨Androidä¸Šå†™äº›å°è„šæœ¬å§ï¼</description>
      <content:encoded><![CDATA[<blockquote>
<p>æœ€è¿‘è–…ğŸ¦™æ¥è§¦äº†autojsï¼Œåœ¨Androidæ‰‹æœºä¸Šå¯è‡ªåŠ¨åŒ–è¿è¡Œçš„è„šæœ¬ï¼Œä¸ç”¨rootï¼Œå¯ç›´æ¥è¿è¡Œï¼Œè½»é‡å°å·§ï¼Œåº•å±‚è°ƒç”¨Android APIï¼Œè‡ªå·±å¯å°è£…APIğŸ‘</p>
</blockquote>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p>autojsåŸä½œè€…å·²ä¸å†ç»´æŠ¤ï¼Œæ¨å‡ºäº†autojs.proç‰ˆï¼Œæœ‰é’±çš„å¤§ä½¬å¯ä»¥ç›´æ¥å»å®‰è£…ä¸‹è½½ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿå¾ˆå…¨</p>
<p>æ²¡é’±çš„è¯ï¼Œå¯ä»¥ç”¨autoxjsï¼Œä»åŸæœ‰å¼€æºåº“æ¥æ‰‹è¿‡æ¥çš„ï¼Œå¼€æºå…è´¹</p>
<p><a href="https://github.com/kkevsekk1/AutoX">GitHub - kkevsekk1/AutoX: A UiAutomator on android, does not need root access(å®‰å“å¹³å°ä¸Šçš„JavaScriptè‡ªåŠ¨åŒ–å·¥å…·)</a></p>
<h2 id="å¸¸ç”¨è¯­æ³•">å¸¸ç”¨è¯­æ³•</h2>
<h3 id="è·å–è®¾å¤‡ä¿¡æ¯">è·å–è®¾å¤‡ä¿¡æ¯</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// æ‰“å°è¿è¡Œç¯å¢ƒä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;å±å¹•å®½åº¦:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">width</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nå±å¹•é«˜åº¦:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">height</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nbuildId:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">buildId</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nä¸»æ¿:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">board</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nåˆ¶é€ å•†:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">brand</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nå‹å·:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">model</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\näº§å“åç§°:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">product</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nbootloaderç‰ˆæœ¬:&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nbootloaderç‰ˆæœ¬:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">bootloader</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nç¡¬ä»¶åç§°:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">hardware</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nå”¯ä¸€æ ‡è¯†ç :&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">fingerprint</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nIMEI: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">getIMEI</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nAndroidId: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">getAndroidId</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nMac: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">getMacAddress</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;\nAPI: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">device</span>.<span style="color:#a6e22e">sdkInt</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">str</span>);
</span></span></code></pre></div><h3 id="æ‰“å¼€åº”ç”¨å¸‚åœºappè¯¦æƒ…é¡µ">æ‰“å¼€åº”ç”¨å¸‚åœºappè¯¦æƒ…é¡µ</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">//æ‰“å¼€åº”ç”¨å¸‚åœºappè¯¦æƒ…é¡µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">startAppStore</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">toastLog</span>(<span style="color:#e6db74">&#34;å»åº”ç”¨å¸‚åœº...&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">intent</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">action</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;VIEW&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// type: &#34;image/png&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">parseUri</span>(<span style="color:#e6db74">&#39;market://details?id=&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pkgName</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">flags</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;activity_new_task&#34;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">packageName</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">myDevice</span>(<span style="color:#e6db74">&#34;Markets&#34;</span>),
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">startActivity</span>(<span style="color:#a6e22e">i</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="æ£€æµ‹appå®‰è£…çŠ¶æ€">æ£€æµ‹appå®‰è£…çŠ¶æ€</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// é€šè¿‡åˆ¤æ–­åŒ…ååˆ¤æ–­æ˜¯å¦å®‰è£…app
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">getAppName</span>(<span style="color:#a6e22e">pkgName</span>)
</span></span></code></pre></div><h3 id="è·å–å½“å‰æ—¶é—´">è·å–å½“å‰æ—¶é—´</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getCurData</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">now</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">timeNow</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getFullYear</span>(); <span style="color:#75715e">//å¾—åˆ°å¹´ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">m</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getMonth</span>() <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;<span style="color:#75715e">//å¾—åˆ°æœˆä»½
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getDate</span>();<span style="color:#75715e">//å¾—åˆ°æ—¥æœŸ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// let day = now.getDay();//å¾—åˆ°å‘¨å‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">h</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getHours</span>();<span style="color:#75715e">//å¾—åˆ°å°æ—¶æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getMinutes</span>();<span style="color:#75715e">//å¾—åˆ°åˆ†é’Ÿæ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">s</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getSeconds</span>();<span style="color:#75715e">//å¾—åˆ°ç§’æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">timeNow</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">m</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">h</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">s</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// log(timeNow);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">timeNow</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="è°ƒè¯•">è°ƒè¯•</h2>
<p>åœ¨vscodeå†…å®‰è£…<a href="https://marketplace.visualstudio.com/items?itemName=aaroncheng.auto-js-vsce-fixed">è°ƒè¯•æ’ä»¶</a></p>
<blockquote>
<p>1ã€æŒ‰Â <code>Ctrl+Shift+P</code>Â æˆ–ç‚¹å‡»&quot;æŸ¥çœ‹&quot;-&gt;&ldquo;å‘½ä»¤é¢æ¿&quot;å¯è°ƒå‡ºå‘½ä»¤é¢æ¿ï¼Œè¾“å…¥Â <code>Autox.js</code>Â å¯ä»¥çœ‹åˆ°å‡ ä¸ªå‘½ä»¤ï¼Œç§»åŠ¨å…‰æ ‡åˆ°å‘½ä»¤<code>Auto.js Autox,js: Start All Server</code>ï¼ŒæŒ‰å›è½¦é”®æ‰§è¡Œè¯¥å‘½ä»¤ã€‚</p>
<p>2ã€é€šè¿‡æ— çº¿æˆ–æœ‰çº¿è¿æ¥</p>
<p>3ã€ä¹‹åå°±å¯ä»¥åœ¨ç”µè„‘ä¸Šç¼–è¾‘JavaScriptæ–‡ä»¶å¹¶é€šè¿‡å‘½ä»¤<code>Run</code>æˆ–è€…æŒ‰é”®<code>F5</code>åœ¨æ‰‹æœºä¸Šè¿è¡Œäº†ã€‚</p>
</blockquote>
<h2 id="æ‰“åŒ…">æ‰“åŒ…</h2>
<p>è°ƒè¯•å®Œæˆåï¼ŒæŒ‰Â <code>Ctrl+Shift+P</code>Â æˆ–ç‚¹å‡»&quot;æŸ¥çœ‹&rdquo;-&gt;&ldquo;å‘½ä»¤é¢æ¿&quot;å¯è°ƒå‡ºå‘½ä»¤é¢æ¿ï¼Œè¾“å…¥Â <code>Autox.js</code>Â å¯ä»¥çœ‹åˆ°å‡ ä¸ªå‘½ä»¤ï¼Œç§»åŠ¨å…‰æ ‡åˆ°å‘½ä»¤<code>Auto.js Autox,js: Save On Device</code>ï¼ŒæŒ‰å›è½¦é”®æ‰§è¡Œè¯¥å‘½ä»¤ã€‚</p>
<p>ä¿å­˜åˆ°æ‰‹æœºä¸Šåï¼Œé€‰æ‹©æ›´å¤šâ€”æ‰“åŒ…åº”ç”¨</p>
<p>ç­‰å¾…æ‰“åŒ…æˆåŠŸåï¼Œå°½æƒ…äº«ç”¨å§ï¼ğŸ‰</p>
<p>psï¼šç›®å‰æœ€æ–°ç‰ˆéƒ½æ˜¯X64æ¶æ„çš„ï¼Œå¦‚éœ€X32æ¶æ„éœ€è¦è£…è€ç‰ˆæœ¬å³å¯</p>
<hr>
<blockquote>
<p>psï¼šå¦‚æœæƒ³æƒ³å†™ä¸ªç®€å•çš„å°è„šæœ¬ï¼Œè¿˜æ˜¯ç”¨autojsä¸é”™ï¼Œç®€å•è½»ä¾¿ï¼Œç”¨appiumé‚£ä¸€å¥—æ¶æ„å¤ªé‡äº†ï¼Œæ€é¸¡ç„‰ç”¨ç‰›åˆ€å•Šï¼</p>
<p>æé«˜è®¤çŸ¥ï¼Œé™ç»´æ‰“å‡»ï¼</p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>äº‘æœåŠ¡å™¨dockeræ­å»ºè‡ªåŠ¨é¢†äº¬è±†botäº’åŠ¨æŒ‡ä»¤</title>
      <link>https://blog.zsan.cf/posts/docker-build-jdbot/</link>
      <pubDate>Fri, 30 Apr 2021 22:49:08 +0000</pubDate>
      
      <guid>https://blog.zsan.cf/posts/docker-build-jdbot/</guid>
      <description>ä½¿ç”¨dockeréƒ¨ç½²è‡ªåŠ¨é¢†é‡‘è±†botè„šæœ¬
ä½¿ç”¨çš„ç‰ˆæœ¬ï¼š
æœåŠ¡å™¨ï¼šcentos 8
dockerï¼š 20.10.6
docker-composeï¼š 1.27.4
1ã€æœåŠ¡å™¨å®‰è£…dockerï¼Œdocker-compose æ¨èä½¿ç”¨centosæœåŠ¡å™¨å®‰è£…dockerã€docker-compose
Dockerå®‰è£…
å›½å†…ä¸€é”®å®‰è£… curl -sSL https://get.daocloud.io/docker | sh å›½å¤–ä¸€é”®å®‰è£… curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun docker-composeå®‰è£…
$ sudo curl -L &amp;quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&amp;quot; -o /usr/local/bin/docker-compose
è¦å®‰è£…å…¶ä»–ç‰ˆæœ¬çš„ Composeï¼Œè¯·æ›¿æ¢ 1.24.1ã€‚
æœ€æ–°å‘è¡Œçš„ç‰ˆæœ¬åœ°å€ï¼šhttps://github.com/docker/compose/releasesã€‚
å°†å¯æ‰§è¡Œæƒé™åº”ç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š
$ sudo chmod +x /usr/local/bin/docker-compose
åˆ›å»ºè½¯é“¾ï¼š
$ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
é€šè¿‡docker-compose versionæŸ¥çœ‹docker-composeç‰ˆæœ¬ï¼Œç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸã€‚
2ã€å®‰è£…jd_scripts åˆ›å»ºä¸€ä¸ªç›®å½•jd_scriptsç”¨äºå­˜æ”¾å¤‡ä»½é…ç½®ç­‰æ•°æ®ï¼Œè¿ç§»é‡è£…çš„æ—¶å€™åªéœ€è¦å¤‡ä»½æ•´ä¸ªjd_scriptsç›®å½•å³å¯
éœ€è¦æ–°å»ºçš„ç›®å½•æ–‡ä»¶ç»“æ„å‚è€ƒå¦‚ä¸‹:
jd_scripts â”œâ”€â”€ logs â”‚Â â”œâ”€â”€ XXXX.log â”‚Â â””â”€â”€ XXXX.log â”œâ”€â”€ my_crontab_list.sh â””â”€â”€ docker-compose.yml jd_scripts/logså»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹å°±è¡Œ jd_scripts/docker-compose.yml å‚è€ƒå†…å®¹å¦‚ä¸‹(è‡ªå·±åŠ¨æ‰‹èƒ½åŠ›ä¸è¡Œæä¸å®šè¯·ä½¿ç”¨é»˜è®¤é…ç½®)ï¼š æ ¹æ®æ–‡æ¡£ä¸€æ­¥ä¸€æ­¥ä¸‹å»å°±okäº†ï¼Œä¸‹é¢ä¸»è¦è®°å½•ä¸‹å¯èƒ½ç”¨åˆ°çš„å‘½ä»¤
ç›®å½•æ–‡ä»¶é…ç½®å¥½ä¹‹ååœ¨ jd_scriptsç›®å½•æ‰§è¡Œã€‚
docker-compose up -d å¯åŠ¨ï¼ˆä¿®æ”¹docker-compose.ymlåéœ€è¦ä½¿ç”¨æ­¤å‘½ä»¤ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼‰ï¼›
docker-compose logs æ‰“å°æ—¥å¿—ï¼›
docker-compose logs -f æ‰“å°æ—¥å¿—ï¼Œ-fè¡¨ç¤ºè·Ÿéšæ—¥å¿—ï¼› docker logs -f jd_scripts å’Œä¸Šé¢ä¸¤æ¡ç›¸æ¯”å¯ä»¥æ˜¾ç¤ºæ±‰å­—ï¼› docker-compose pull æ›´æ–°é•œåƒï¼›
docker-compose stop åœæ­¢å®¹å™¨ï¼›
docker-compose restart é‡å¯å®¹å™¨ï¼›
docker-compose down åœæ­¢å¹¶åˆ é™¤å®¹å™¨ï¼›
3ã€å¼€ä»£ç†æœºå™¨ï¼Œæ¿€æ´»tg-bot è¿™é‡Œæ˜¯ä¸ªå¤§å‘ï¼Œæ‹¿ä¸ªå°æœ¬æœ¬è®°ä¸‹æ¥ï¼Œå…¶å®å°±æ˜¯dockerå†…ä»£ç†å®¿ä¸»æœºä»£ç†çš„é—®é¢˜
ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå›½å†…çš„æœºå™¨ä¸èƒ½è®¿é—®tgï¼Œè€Œåˆæƒ³ä½¿ç”¨tg-botæ¥æ§åˆ¶ï¼Œæ— å¥ˆï¼Œå›½å¤–æœºå­å¤ªè´µï¼ˆç©·ï¼‰ï¼Œæœ€ä½ä¹Ÿè¦5ç¾åˆ€ï¼é‚ä¹°å›½å†…æœºå­å¼€ä»£ç†ä½¿ç”¨
1ã€ä¹°å›½å†…æœºå™¨ï¼Œæ¨èå¤§å‚çš„ è¿™é‡Œåº”è¯¥æ”¾å„å¤§å‚çš„affçš„ï¼Œç•™ä¸ªå‘
2ã€å®‰è£…clash ä¸€ç›´åœ¨ä½¿ç”¨clashï¼Œç›´æ¥ç½‘ä¸Šæœç´¢clashä¸‹è½½ï¼Œæ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬ä¸‹è½½ï¼Œåšä¸»ç”¨çš„æ˜¯centosï¼Œä¸‹è½½linux-amd64çš„
1ã€ä¸‹è½½clashï¼Œæœ€æ–°ç‰ˆæœ¬å¯å»å®˜ç½‘æ‰¾
wget https://github.com/Dreamacro/clash/releases/download/v0.19.0/clash-linux-amd64-v0.19.0.gz 2ã€è§£å‹
gzip -d clash-linux-amd64-v0.19.0.gz 3ã€ç§»åŠ¨è‡³usr/bin/clashå¹¶é‡å‘½åä¸ºclash
sudo mv clash-linux-amd64-v0.19.0 /usr/bin/clash 4ã€èµ‹äºˆclashè¿è¡Œæƒé™
sudo chmod +x /usr/bin/clash 5ã€æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ
clash -v 3ã€åˆ›å»ºé…ç½®æ–‡ä»¶ã€å®‰è£…æ§åˆ¶é¢æ¿ 1.åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•
mkdir -p /etc/clash/ 2.è¿›å…¥ç›®å½•
cd /etc/clash/ 3.åˆ›å»ºé…ç½®æ–‡ä»¶
vim config.yaml 4.æ‰‹åŠ¨ç¼–è¾‘å¾ˆéº»çƒ¦ï¼Œå¯ç”¨winscpä¸Šä¼ 
é…ç½®å‚æ•°è‡ªè¡ŒæŸ¥æ‰¾
5.ä¸‹è½½å‰ç«¯ä»£ç 
wget https://github.com/Dreamacro/clash-dashboard/tree/gh-pages 6.è§£å‹</description>
      <content:encoded><![CDATA[<p>ä½¿ç”¨dockeréƒ¨ç½²è‡ªåŠ¨é¢†é‡‘è±†botè„šæœ¬</p>
<!-- more -->
<p>ä½¿ç”¨çš„ç‰ˆæœ¬ï¼š</p>
<p>æœåŠ¡å™¨ï¼šcentos 8</p>
<p>dockerï¼š 20.10.6</p>
<p>docker-composeï¼š 1.27.4</p>
<h3 id="1æœåŠ¡å™¨å®‰è£…dockerdocker-compose">1ã€æœåŠ¡å™¨å®‰è£…dockerï¼Œdocker-compose</h3>
<p>æ¨èä½¿ç”¨centosæœåŠ¡å™¨å®‰è£…dockerã€docker-compose</p>
<p>Dockerå®‰è£…</p>
<ul>
<li>å›½å†…ä¸€é”®å®‰è£… <code>curl -sSL https://get.daocloud.io/docker | sh</code></li>
<li>å›½å¤–ä¸€é”®å®‰è£… <code>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</code></li>
</ul>
<p>docker-composeå®‰è£…</p>
<p><code>$ sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</code></p>
<p>è¦å®‰è£…å…¶ä»–ç‰ˆæœ¬çš„ Composeï¼Œè¯·æ›¿æ¢ 1.24.1ã€‚</p>
<p>æœ€æ–°å‘è¡Œçš„ç‰ˆæœ¬åœ°å€ï¼šhttps://github.com/docker/compose/releasesã€‚</p>
<p>å°†å¯æ‰§è¡Œæƒé™åº”ç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š</p>
<p><code>$ sudo chmod +x /usr/local/bin/docker-compose</code></p>
<p>åˆ›å»ºè½¯é“¾ï¼š</p>
<p><code>$ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</code></p>
<p>é€šè¿‡<code>docker-compose version</code>æŸ¥çœ‹<code>docker-compose</code>ç‰ˆæœ¬ï¼Œç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸã€‚</p>
<h3 id="2å®‰è£…jd_scripts">2ã€å®‰è£…jd_scripts</h3>
<p>åˆ›å»ºä¸€ä¸ªç›®å½•<code>jd_scripts</code>ç”¨äºå­˜æ”¾å¤‡ä»½é…ç½®ç­‰æ•°æ®ï¼Œè¿ç§»é‡è£…çš„æ—¶å€™åªéœ€è¦å¤‡ä»½æ•´ä¸ªjd_scriptsç›®å½•å³å¯</p>
<p>éœ€è¦æ–°å»ºçš„ç›®å½•æ–‡ä»¶ç»“æ„å‚è€ƒå¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>jd_scripts
</span></span><span style="display:flex;"><span>â”œâ”€â”€ logs
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ XXXX.log
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ XXXX.log
</span></span><span style="display:flex;"><span>â”œâ”€â”€ my_crontab_list.sh
</span></span><span style="display:flex;"><span>â””â”€â”€ docker-compose.yml
</span></span></code></pre></div><ul>
<li><code>jd_scripts/logs</code>å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹å°±è¡Œ</li>
<li><code>jd_scripts/docker-compose.yml</code> å‚è€ƒå†…å®¹å¦‚ä¸‹(è‡ªå·±åŠ¨æ‰‹èƒ½åŠ›ä¸è¡Œæä¸å®šè¯·ä½¿ç”¨é»˜è®¤é…ç½®)ï¼š</li>
</ul>
<p>æ ¹æ®æ–‡æ¡£ä¸€æ­¥ä¸€æ­¥ä¸‹å»å°±okäº†ï¼Œä¸‹é¢ä¸»è¦è®°å½•ä¸‹å¯èƒ½ç”¨åˆ°çš„å‘½ä»¤</p>
<p>ç›®å½•æ–‡ä»¶é…ç½®å¥½ä¹‹ååœ¨ <code>jd_scripts</code>ç›®å½•æ‰§è¡Œã€‚<br>
<code>docker-compose up -d</code> å¯åŠ¨ï¼ˆä¿®æ”¹docker-compose.ymlåéœ€è¦ä½¿ç”¨æ­¤å‘½ä»¤ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼‰ï¼›<br>
<code>docker-compose logs</code> æ‰“å°æ—¥å¿—ï¼›<br>
<code>docker-compose logs -f</code> æ‰“å°æ—¥å¿—ï¼Œ-fè¡¨ç¤ºè·Ÿéšæ—¥å¿—ï¼›
<code>docker logs -f jd_scripts</code> å’Œä¸Šé¢ä¸¤æ¡ç›¸æ¯”å¯ä»¥æ˜¾ç¤ºæ±‰å­—ï¼›
<code>docker-compose pull</code> æ›´æ–°é•œåƒï¼›<br>
<code>docker-compose stop</code> åœæ­¢å®¹å™¨ï¼›<br>
<code>docker-compose restart</code> é‡å¯å®¹å™¨ï¼›<br>
<code>docker-compose down</code> åœæ­¢å¹¶åˆ é™¤å®¹å™¨ï¼›</p>
<h3 id="3å¼€ä»£ç†æœºå™¨æ¿€æ´»tg-bot">3ã€å¼€ä»£ç†æœºå™¨ï¼Œæ¿€æ´»tg-bot</h3>
<p>è¿™é‡Œæ˜¯ä¸ªå¤§å‘ï¼Œæ‹¿ä¸ªå°æœ¬æœ¬è®°ä¸‹æ¥ï¼Œå…¶å®å°±æ˜¯dockerå†…ä»£ç†å®¿ä¸»æœºä»£ç†çš„é—®é¢˜</p>
<p>ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå›½å†…çš„æœºå™¨ä¸èƒ½è®¿é—®tgï¼Œè€Œåˆæƒ³ä½¿ç”¨tg-botæ¥æ§åˆ¶ï¼Œæ— å¥ˆï¼Œå›½å¤–æœºå­å¤ªè´µï¼ˆç©·ï¼‰ï¼Œæœ€ä½ä¹Ÿè¦5ç¾åˆ€ï¼é‚ä¹°å›½å†…æœºå­å¼€ä»£ç†ä½¿ç”¨</p>
<h5 id="1ä¹°å›½å†…æœºå™¨æ¨èå¤§å‚çš„">1ã€ä¹°å›½å†…æœºå™¨ï¼Œæ¨èå¤§å‚çš„</h5>
<p>è¿™é‡Œåº”è¯¥æ”¾å„å¤§å‚çš„affçš„ï¼Œç•™ä¸ªå‘</p>
<h5 id="2å®‰è£…clash">2ã€å®‰è£…clash</h5>
<p>ä¸€ç›´åœ¨ä½¿ç”¨clashï¼Œç›´æ¥ç½‘ä¸Šæœç´¢clash<a href="https://github.com/Dreamacro/clash/releases">ä¸‹è½½</a>ï¼Œæ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬ä¸‹è½½ï¼Œåšä¸»ç”¨çš„æ˜¯centosï¼Œä¸‹è½½linux-amd64çš„</p>
<p>1ã€ä¸‹è½½clashï¼Œæœ€æ–°ç‰ˆæœ¬å¯å»å®˜ç½‘æ‰¾</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wget https://github.com/Dreamacro/clash/releases/download/v0.19.0/clash-linux-amd64-v0.19.0.gz
</span></span></code></pre></div><p>2ã€è§£å‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gzip -d clash-linux-amd64-v0.19.0.gz
</span></span></code></pre></div><p>3ã€ç§»åŠ¨è‡³usr/bin/clashå¹¶é‡å‘½åä¸ºclash</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo mv clash-linux-amd64-v0.19.0 /usr/bin/clash
</span></span></code></pre></div><p>4ã€èµ‹äºˆclashè¿è¡Œæƒé™</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo chmod +x /usr/bin/clash
</span></span></code></pre></div><p>5ã€æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>clash -v 
</span></span></code></pre></div><h5 id="3åˆ›å»ºé…ç½®æ–‡ä»¶å®‰è£…æ§åˆ¶é¢æ¿">3ã€åˆ›å»ºé…ç½®æ–‡ä»¶ã€å®‰è£…æ§åˆ¶é¢æ¿</h5>
<p>1.åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /etc/clash/
</span></span></code></pre></div><p>2.è¿›å…¥ç›®å½•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /etc/clash/
</span></span></code></pre></div><p>3.åˆ›å»ºé…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vim config.yaml
</span></span></code></pre></div><p>4.æ‰‹åŠ¨ç¼–è¾‘å¾ˆéº»çƒ¦ï¼Œå¯ç”¨winscpä¸Šä¼ </p>
<p>é…ç½®å‚æ•°è‡ªè¡ŒæŸ¥æ‰¾</p>
<p>5.ä¸‹è½½å‰ç«¯ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wget https://github.com/Dreamacro/clash-dashboard/tree/gh-pages
</span></span></code></pre></div><p>6.è§£å‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>unzip gh-pages.zip
</span></span></code></pre></div><p>7.ä¿®æ”¹ç›®å½•å,è¿™é‡Œçš„ç›®å½•åæ˜¯ä¸Šé¢é…ç½®æ–‡ä»¶é‡Œçš„ external-ui: dashboard</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mv clash-dashboard-gh-pages dashboard
</span></span></code></pre></div><p><a href="http://clash.razord.top/">å¯ç”¨è¿™ä¸ªé¢æ¿è¿œç¨‹æ§åˆ¶</a></p>
<h5 id="4è®¾ç½®clashå¼€æœºå¯åŠ¨">4ã€è®¾ç½®clashå¼€æœºå¯åŠ¨</h5>
<p>1.åˆ›å»ºserviceæ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo vim /usr/lib/systemd/system/clash.service
</span></span></code></pre></div><p>2.è¾“å…¥ä¸‹é¢ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>clash proxy
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>network.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>simple
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/usr/bin/clash -d /etc/clash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><p>3.é‡æ–°åŠ è½½ systemd æ¨¡å—</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span></code></pre></div><p>4.å¯åŠ¨Clash</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo systemctl start clash.service
</span></span></code></pre></div><p>5.è®¾ç½®Clashå¼€æœºè‡ªå¯åŠ¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo systemctl enable clash.service
</span></span></code></pre></div><p>6.åˆ¤æ–­æ˜¯å¦æˆåŠŸå¼€å¯ä»£ç†</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl -I https://www.google.com
</span></span></code></pre></div><p>è¿”å›200å³è¡¨ç¤ºä»£ç†å·²ç»æˆåŠŸ</p>
<h5 id="5è‡ªåŠ¨æ›´æ–°è®¢é˜…é…ç½®æ–‡ä»¶">5ã€è‡ªåŠ¨æ›´æ–°è®¢é˜…é…ç½®æ–‡ä»¶</h5>
<blockquote>
<p>é€šè¿‡shellè„šæœ¬è‡ªåŠ¨æ›´æ–°Clashåœ¨çº¿é…ç½®</p>
</blockquote>
<p>é€šè¿‡systemctlæ¥ç®¡ç†Clashçš„è¿›ç¨‹ï¼Œå¯¹åº”<code>clash.service</code>æ–‡ä»¶ï¼Œé€šè¿‡ä¸¤ä¸ªè„šæœ¬<code>start-clash.sh</code>å’Œ<code>stop-clash.sh</code>æ¥ç®¡ç†Clashçš„å¯åœï¼š</p>
<p>æŠŠä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vim /usr/lib/systemd/system/clash.service
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>clash proxy
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>network.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WorkingDirectory<span style="color:#f92672">=</span>/å½“å‰ç”¨æˆ·ç›®å½•/.config/clash
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>simple
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/å½“å‰ç”¨æˆ·ç›®å½•/.config/clash/start-clash.sh
</span></span><span style="display:flex;"><span>ExecStop<span style="color:#f92672">=</span>/å½“å‰ç”¨æˆ·ç›®å½•/.config/clash/stop-clash.sh
</span></span><span style="display:flex;"><span>Environment<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;HOME=/å½“å‰ç”¨æˆ·ç›®å½•&#34;</span>
</span></span><span style="display:flex;"><span>Environment<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;CLASH_URL=ä½ çš„è®¢é˜…é“¾æ¥&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vim /å½“å‰ç”¨æˆ·ç›®å½•/.config/clash/start-clash.sh
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e"># save this file to ${HOME}/.config/clash/start-clash.sh</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># save pid file</span>
</span></span><span style="display:flex;"><span>echo $$ &gt; <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.config/clash/clash.pid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>diff <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.config/clash/config.yaml &lt;<span style="color:#f92672">(</span>curl -s <span style="color:#e6db74">${</span>CLASH_URL<span style="color:#e6db74">}</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$?<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    /usr/bin/clash
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    TIME<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>date <span style="color:#e6db74">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>    cp <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.config/clash/config.yaml <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/.config/clash/config.yaml.bak</span><span style="color:#e6db74">${</span>TIME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    curl -L -o <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.config/clash/config.yaml <span style="color:#e6db74">${</span>CLASH_URL<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>    /usr/bin/clash
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vim /å½“å‰ç”¨æˆ·ç›®å½•/.config/clash/stop-clash.sh
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e"># save this file to ${HOME}/.config/clash/stop-clash.sh</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># read pid file</span>
</span></span><span style="display:flex;"><span>PID<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>cat <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.config/clash/clash.pid<span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>kill -9 <span style="color:#e6db74">${</span>PID<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>rm <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.config/clash/clash.pid
</span></span></code></pre></div><p>é…ç½®æ·»åŠ å®Œæˆåï¼Œå¦‚æœä½ çš„clash æ­£åœ¨è¿è¡Œä¸­ï¼Œéœ€è¦é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶å¹¶é‡å¯</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ sudo systemctl restart clash.service
</span></span></code></pre></div><p>è¿™æ ·æ¯æ¬¡å¯åŠ¨clashæ—¶å°±ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®æ–‡ä»¶äº†ï¼Œæ¥ä¸‹æ¥é€šè¿‡crontab è‡ªåŠ¨é‡å¯ clash.serviceå®ç°è‡ªåŠ¨æ›´æ–°èŠ‚ç‚¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#æ–°å»ºshellæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>vim restart-clash.sh
</span></span></code></pre></div><p>æ–°å¢ä¸€æ¡å‘½ä»¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#/bin/sh</span>
</span></span><span style="display:flex;"><span>sudo systemctl restart clash.service
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chmod +x restart-clash.sh
</span></span><span style="display:flex;"><span>crontab -e
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ’å…¥ä¸‹é¢å‘½ä»¤</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ¯3å°æ—¶é‡å¯ä¸€æ¬¡</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> */3 * * * restart-clash.sh
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ¯åˆ†é’Ÿé‡å¯ä¸€æ¬¡</span>
</span></span><span style="display:flex;"><span>* * * * * restart-clash.sh
</span></span></code></pre></div><p>å¤§åŠŸå‘Šæˆï¼Œå¯é€šè¿‡<code>tail -500f /var/log/cron</code>æŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ˜¯å¦æ‰§è¡Œ</p>
<p><code>sudo systemctl status clash.service</code>  æŸ¥çœ‹æ˜¯å¦é‡å¯æˆåŠŸ</p>
<h3 id="4dockerå†…å¼€ä»£ç†">4ã€dockerå†…å¼€ä»£ç†</h3>
<p>ç”±äºä¸»è¦ç”¨æ¥ä½¿ç”¨tg-botï¼Œæ•…åªæ£€æµ‹tgapiå³å¯</p>
<p>1ã€åˆ¤æ–­å®¿ä¸»æœºå¯è¿æ¥tgapi</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl -sX POST <span style="color:#e6db74">&#34;https://api.telegram.org/bot&#39;&#39;&#39;Your Token&#39;&#39;&#39;/sendMessage&#34;</span> -d <span style="color:#e6db74">&#34;chat_id=&#34;</span>Some Chat id<span style="color:#e6db74">&#34;&amp;text=hello&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -sX POST <span style="color:#e6db74">&#34;https://api.telegram.org/botxxxxxxxxugt5A/sendMessage&#34;</span> -d <span style="color:#e6db74">&#34;chat_id=48xxxxxx&amp;text=hello&#34;</span>
</span></span></code></pre></div><p>å¦‚æœè¿”å›æˆåŠŸï¼Œå³è¡¨ç¤ºæˆåŠŸ</p>
<p>2ã€è¿›å…¥å®¹å™¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker exec -it jd_scripts /bin/sh
</span></span></code></pre></div><p>æ‰§è¡Œæ­¥éª¤1å‘½ä»¤ï¼Œå¦‚è‹¥å“åº”æ—¶é—´é•¿æˆ–å¤±è´¥ï¼Œåˆ™éœ€è¦é…ç½®ä»£ç†</p>
<p>3ã€é…ç½®å®¹å™¨ä»£ç†èµ°å®¿ä¸»æœº</p>
<p><a href="https://docs.docker.com/network/proxy/#use-environment-variables">dockerå®˜æ–¹æœ‰æ•™ç¨‹</a></p>
<p>dockerç‰ˆæœ¬å¤§äº 17.07ä»¥ä¸Šå¯ç”¨ä¸‹é¢çš„æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd
</span></span><span style="display:flex;"><span>mkdir .docker
</span></span><span style="display:flex;"><span>vim  ~/.docker/config.json
</span></span></code></pre></div><p>å¡«å…¥ä¸‹é¢json</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&#34;proxies&#34;</span>:
</span></span><span style="display:flex;"><span> {
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">&#34;default&#34;</span>:
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&#34;httpProxy&#34;</span>: <span style="color:#e6db74">&#34;http://172.17.0.1:7890&#34;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&#34;httpsProxy&#34;</span>: <span style="color:#e6db74">&#34;http://172.17.0.1:7890&#34;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&#34;noProxy&#34;</span>: <span style="color:#e6db74">&#34;localhost,127.0.0.1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&#34;</span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä¿å­˜æ–‡ä»¶<strong>åˆ›å»ºæˆ–è€…å¯åŠ¨æ–°å®¹å™¨æ—¶æ‰ç”Ÿæ•ˆ</strong></p>
<p>è¿™é‡Œæœ‰ä¸ªå¤§å‘ï¼Œæäº†ä¸€å¤©ï¼Œå°±æ˜¯</p>
<p><strong>ä»£ç†çš„ipä¸€å®šè¦å†™å¯¹ï¼</strong></p>
<p><strong>ä»£ç†çš„ipä¸€å®šè¦å†™å¯¹ï¼</strong></p>
<p><strong>ä»£ç†çš„ipä¸€å®šè¦å†™å¯¹!</strong></p>
<blockquote>
<p>ä¸‹åˆè°ƒè¯•çš„æ—¶å€™httpsçš„å†™æˆäº†127çš„äº†ï¼Œæœºå™¨å¯åŠ¨èµ·æ¥ï¼Œpullä»£ç çš„æ—¶å€™ï¼Œç›´æ¥æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œå½“æ—¶è¿˜éª‚è¿™ç ´ä»£ç†ï¼Œæ²¡æ³•ï¼Œå°±æŠŠæŠ¥é”™ipä¸èµ°ä»£ç†äº†ï¼Œæ²¡æƒ³åˆ°ä¸‹é¢ä¸æŠ¥é”™äº†ï¼Œç›´æ¥æ— é™é‡å¯ï¼Œæå¾—å¤´éƒ½å¤§äº†ï¼Œè¿˜åœ¨æƒ³æ˜¯ä¸æ˜¯å†…å­˜çˆ†äº†å‘¢ï¼æ™šä¸Šï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œå®šç›ä¸€çœ‹ï¼ŒWCï¼&ldquo;httpsProxy&quot;ç«¯å£å†™çš„127&hellip;èµ¶ç´§æ”¹äº†ï¼Œé‡æ–°è·‘éï¼Œå¦¥äº†ï¼ŒbotæˆåŠŸäº†ï¼</p>
</blockquote>
<p>4ã€åˆ é™¤å®¹å™¨ï¼Œé‡æ–°å¯ç”¨</p>
<p>æ¥ä¸‹æ¥åœ¨jd_scripts ç›®å½•å†…</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker-compose down
</span></span><span style="display:flex;"><span>docker-compose up -d
</span></span></code></pre></div><p>å¯åŠ¨æˆåŠŸåï¼Œtgbotå³å¯æ”¶åˆ°æˆåŠŸçš„æ¶ˆæ¯ï¼Œå°½æƒ…äº«ç”¨å§ï¼</p>
<h3 id="clashç›¸å…³çš„ç®¡ç†å‘½ä»¤">Clashç›¸å…³çš„ç®¡ç†å‘½ä»¤</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">## å¯åŠ¨Clash ##</span>
</span></span><span style="display:flex;"><span>sudo systemctl start clash.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## é‡å¯Clash ##</span>
</span></span><span style="display:flex;"><span>sudo systemctl restart clash.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## æŸ¥çœ‹Clashè¿è¡ŒçŠ¶æ€ ##</span>
</span></span><span style="display:flex;"><span>sudo systemctl status clash.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## å®æ—¶æ»šåŠ¨çŠ¶æ€ ##</span>
</span></span><span style="display:flex;"><span>sudo journalctl -u clash.service -f
</span></span></code></pre></div><h3 id="dockerç›¸å…³å‘½ä»¤">dockerç›¸å…³å‘½ä»¤</h3>
<p><code>docker exec -it jd_scripts /bin/sh -c 'git -C /scripts pull &amp;&amp; node /scripts/jd_bean_change.js'</code>  æ‰‹åŠ¨è¿è¡Œä¸€è„šæœ¬</p>
<p><code>docker exec -it jd_scripts /bin/sh -c 'env'</code>  æŸ¥çœ‹è®¾ç½®çš„ç¯å¢ƒå˜é‡</p>
<p><code>docker exec -it jd_scripts /bin/sh -c 'crontab -l'</code>  æŸ¥çœ‹å·²ç”Ÿæ•ˆçš„crontab_listå®šæ—¶å™¨ä»»åŠ¡</p>
<p><code>docker exec -it jd_scripts sh -c &quot;docker_entrypoint.sh&quot;</code> æ‰‹åŠ¨æ›´æ–°jd_scriptsä»“åº“æœ€æ–°è„šæœ¬</p>
<p><code>docker exec -it jd_scripts /bin/sh</code> ä»…è¿›å…¥å®¹å™¨å‘½ä»¤</p>
<p><code>rm -rf  logs/*.log</code> åˆ é™¤logsæ–‡ä»¶å¤¹é‡Œé¢æ‰€æœ‰çš„æ—¥å¿—æ–‡ä»¶</p>
<ul>
<li>[1] <a href="https://github.com/wisz2021/jd_docker">jd_docker</a></li>
<li>[2] <a href="https://github.com/yuanlam/Clash-Linux">clashå®‰è£…å‚è€ƒ</a></li>
<li>[3] <a href="https://kebingzao.com/2019/02/22/docker-container-proxy/">dockerå†…ä»£ç†å‚è€ƒ</a></li>
<li>[4] <a href="https://akillcool.github.io/post/clash-with-auto-update-config/">clashè‡ªåŠ¨æ›´æ–°è®¢é˜…é…ç½®</a></li>
</ul>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
